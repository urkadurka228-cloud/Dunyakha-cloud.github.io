<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Minecraft Clicker Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            user-select: none;
        }
        
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #2196F3;
            --accent-color: #FF9800;
            --danger-color: #F44336;
            --success-color: #4CAF50;
            --gold-color: #FFD700;
            --lucky-color: #FFEB3B;
            --dark-bg: #1a1a2e;
            --menu-bg: #0f4c75;
            --block-border: #8B4513;
            --epic-color: #9C27B0;
            --legendary-color: #FF9800;
            --mythic-color: #FF4081;
        }
        
        body {
            background-color: var(--dark-bg);
            color: white;
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #game-container {
            width: 100%;
            height: 100%;
            max-width: 500px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }
        
        /* Загрузочный экран */
        #loading-screen {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, var(--menu-bg), #1b262c);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            animation: fadeOut 0.5s 0.5s forwards;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: var(--gold-color);
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        .loading-text {
            font-size: 1.2rem;
            color: var(--gold-color);
            animation: pulse 1.5s infinite;
        }
        
        /* Меню */
        #menu-screen {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, var(--menu-bg), #1b262c);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            animation: fadeIn 0.8s;
        }
        
        .menu-title {
            font-size: 3.5rem;
            color: var(--gold-color);
            margin-bottom: 2rem;
            text-align: center;
            text-shadow: 3px 3px 0 var(--block-border), 5px 5px 0 #000;
            letter-spacing: 2px;
            font-family: 'Minecraft', monospace;
            animation: titleGlow 3s infinite alternate;
        }
        
        @keyframes titleGlow {
            0% { text-shadow: 3px 3px 0 var(--block-border), 5px 5px 0 #000, 0 0 10px rgba(255,215,0,0.3); }
            100% { text-shadow: 3px 3px 0 var(--block-border), 5px 5px 0 #000, 0 0 20px rgba(255,215,0,0.8); }
        }
        
        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 80%;
            max-width: 300px;
        }
        
        .menu-btn {
            background: linear-gradient(45deg, var(--primary-color), #2E7D32);
            color: white;
            border: none;
            padding: 1rem;
            font-size: 1.3rem;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 6px 0 #1B5E20, 0 8px 15px rgba(0,0,0,0.4);
            transition: all 0.2s;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            animation: fadeInUp 0.5s backwards;
        }
        
        .menu-btn:nth-child(1) { animation-delay: 0.2s; }
        .menu-btn:nth-child(2) { animation-delay: 0.3s; }
        .menu-btn:nth-child(3) { animation-delay: 0.4s; }
        .menu-btn:nth-child(4) { animation-delay: 0.5s; }
        .menu-btn:nth-child(5) { animation-delay: 0.6s; }
        .menu-btn:nth-child(6) { animation-delay: 0.7s; }
        
        .menu-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 0 #1B5E20, 0 10px 20px rgba(0,0,0,0.5);
        }
        
        .menu-btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #1B5E20, 0 5px 10px rgba(0,0,0,0.4);
        }
        
        .menu-btn i {
            font-size: 1.2rem;
        }
        
        .continue-btn {
            background: linear-gradient(45deg, var(--secondary-color), #1565C0);
            box-shadow: 0 6px 0 #0D47A1, 0 8px 15px rgba(0,0,0,0.4);
        }
        
        .continue-btn:hover {
            box-shadow: 0 8px 0 #0D47A1, 0 10px 20px rgba(0,0,0,0.5);
        }
        
        .continue-btn:active {
            box-shadow: 0 2px 0 #0D47A1, 0 5px 10px rgba(0,0,0,0.4);
        }
        
        .stats-btn {
            background: linear-gradient(45deg, #9C27B0, #7B1FA2);
            box-shadow: 0 6px 0 #4A148C, 0 8px 15px rgba(0,0,0,0.4);
        }
        
        .stats-btn:hover {
            box-shadow: 0 8px 0 #4A148C, 0 10px 20px rgba(0,0,0,0.5);
        }
        
        .stats-btn:active {
            box-shadow: 0 2px 0 #4A148C, 0 5px 10px rgba(0,0,0,0.4);
        }
        
        .achievements-btn {
            background: linear-gradient(45deg, #FF9800, #F57C00);
            box-shadow: 0 6px 0 #E65100, 0 8px 15px rgba(0,0,0,0.4);
        }
        
        .achievements-btn:hover {
            box-shadow: 0 8px 0 #E65100, 0 10px 20px rgba(0,0,0,0.5);
        }
        
        .achievements-btn:active {
            box-shadow: 0 2px 0 #E65100, 0 5px 10px rgba(0,0,0,0.4);
        }
        
        .settings-btn {
            background: linear-gradient(45deg, #757575, #616161);
            box-shadow: 0 6px 0 #424242, 0 8px 15px rgba(0,0,0,0.4);
        }
        
        .settings-btn:hover {
            box-shadow: 0 8px 0 #424242, 0 10px 20px rgba(0,0,0,0.5);
        }
        
        .settings-btn:active {
            box-shadow: 0 2px 0 #424242, 0 5px 10px rgba(0,0,0,0.4);
        }
        
        .privacy-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent;
            border: 2px solid #fff;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .privacy-btn:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .version {
            position: absolute;
            bottom: 20px;
            color: rgba(255,255,255,0.5);
            font-size: 0.8rem;
        }
        
        /* Игровой экран */
        #game-screen {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #87CEEB, #1E90FF);
            display: none;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            z-index: 5;
        }
        
        .game-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 12px;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
            animation: slideDown 0.5s;
        }
        
        .coins-container {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.2rem;
            color: var(--gold-color);
            font-weight: bold;
            background: rgba(0,0,0,0.4);
            padding: 5px 12px;
            border-radius: 20px;
            animation: coinPulse 2s infinite;
        }
        
        .coin-icon {
            width: 24px;
            height: 24px;
            background: radial-gradient(circle at 30% 30%, var(--gold-color), #B8860B);
            border-radius: 50%;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            animation: coinSpin 4s infinite linear;
        }
        
        @keyframes coinSpin {
            0% { transform: rotateY(0); }
            100% { transform: rotateY(360deg); }
        }
        
        .coin-icon::after {
            content: '';
            position: absolute;
            top: 5px;
            left: 8px;
            width: 8px;
            height: 8px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
        }
        
        .stage-container {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 1rem;
            color: #FF9800;
            font-weight: bold;
            background: rgba(0,0,0,0.4);
            padding: 5px 12px;
            border-radius: 20px;
        }
        
        .game-buttons {
            display: flex;
            gap: 10px;
        }
        
        .game-header-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s;
        }
        
        .game-header-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.1) rotate(5deg);
        }
        
        .block-info-container {
            width: 100%;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            text-align: center;
            animation: fadeIn 0.6s;
        }
        
        .block-name {
            font-size: 2rem;
            color: #fff;
            margin-bottom: 5px;
            text-shadow: 2px 2px 0 #000;
            font-family: 'Minecraft', monospace;
        }
        
        .block-type {
            font-size: 1rem;
            color: #ccc;
            margin-bottom: 10px;
        }
        
        .health-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 5px;
        }
        
        .health-display {
            font-size: 1.5rem;
            color: #ff6b6b;
            font-weight: bold;
            text-shadow: 1px 1px 0 #000;
        }
        
        .health-icon {
            color: #ff6b6b;
            font-size: 1.5rem;
        }
        
        .block-container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            position: relative;
        }
        
        .block {
            width: 240px;
            height: 240px;
            position: relative;
            cursor: pointer;
            transition: transform 0.05s;
            user-select: none;
            border-radius: 8px;
            animation: blockFloat 4s infinite ease-in-out;
        }
        
        @keyframes blockFloat {
            0%, 100% { transform: translateY(0) rotate(0); }
            50% { transform: translateY(-10px) rotate(0.5deg); }
        }
        
        .block.hit {
            animation: hitEffect 0.1s ease-out;
        }
        
        .block.regenerating {
            animation: regeneratingEffect 2s infinite;
        }
        
        .block-img {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            box-shadow: 
                0 10px 20px rgba(0,0,0,0.5),
                inset 0 0 20px rgba(0,0,0,0.2);
            border: 6px solid;
            image-rendering: pixelated;
            transition: all 0.3s;
        }
        
        .block.lucky {
            animation: luckyGlow 1s infinite alternate, blockFloat 3s infinite ease-in-out;
        }
        
        @keyframes luckyGlow {
            0% { box-shadow: 0 0 20px var(--lucky-color), 0 0 40px var(--lucky-color); }
            100% { box-shadow: 0 0 30px var(--lucky-color), 0 0 60px var(--lucky-color); }
        }
        
        .cracks-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            pointer-events: none;
            z-index: 2;
            background-size: cover;
            background-position: center;
            border-radius: 8px;
        }
        
        .regeneration-indicator {
            position: absolute;
            top: -35px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            display: none;
            z-index: 10;
            white-space: nowrap;
        }
        
        .progress-bar-container {
            width: 95%;
            height: 25px;
            background-color: #333;
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
            border: 2px solid var(--block-border);
            animation: fadeIn 0.7s;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--primary-color), #8BC34A);
            width: 0%;
            transition: width 0.3s;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255,255,255,0.3) 50%, 
                transparent 100%);
            animation: shine 2s infinite;
        }
        
        .game-stats {
            width: 95%;
            display: flex;
            justify-content: space-between;
            background: rgba(0,0,0,0.5);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
            animation: fadeIn 0.8s;
        }
        
        .stat-item {
            text-align: center;
            flex: 1;
        }
        
        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--gold-color);
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #ccc;
        }
        
        .coin-hit-animation {
            position: absolute;
            font-size: 1.5rem;
            color: var(--gold-color);
            font-weight: bold;
            pointer-events: none;
            z-index: 10;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            animation: coinHitFloat 1s ease-out forwards;
        }
        
        .auto-clicker-info {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--primary-color);
            display: none;
            animation: autoClickerPulse 2s infinite;
        }
        
        .damage-indicator {
            position: absolute;
            font-size: 1.2rem;
            color: #ff4444;
            font-weight: bold;
            pointer-events: none;
            z-index: 10;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            animation: damageFloat 1s ease-out forwards;
        }
        
        .lucky-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, var(--lucky-color), #FFC107);
            color: #000;
            padding: 20px 30px;
            border-radius: 15px;
            font-size: 2rem;
            font-weight: bold;
            z-index: 1000;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            animation: luckyNotification 3s forwards;
            display: none;
        }
        
        @keyframes luckyNotification {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            10% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            20% { transform: translate(-50%, -50%) scale(1); }
            80% { opacity: 1; }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }
        
        /* Магазин */
        #shop-screen, #stats-screen, #settings-screen, #credits-screen, #achievements-screen {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #2c3e50, #1a1a2e);
            display: none;
            flex-direction: column;
            padding: 20px;
            z-index: 15;
            overflow-y: auto;
            animation: fadeIn 0.5s;
        }
        
        .screen-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary-color);
            animation: slideDown 0.4s;
        }
        
        .screen-title {
            font-size: 2rem;
            color: var(--gold-color);
            font-family: 'Minecraft', monospace;
            text-shadow: 2px 2px 0 #000;
        }
        
        .back-btn {
            background: linear-gradient(45deg, #f44336, #d32f2f);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            box-shadow: 0 3px 0 #b71c1c;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 0 #b71c1c;
        }
        
        /* ЭКРАН ДОСТИЖЕНИЙ */
        .achievements-container {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .achievement-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            animation: fadeIn 0.6s;
        }
        
        .category-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .category-btn.active {
            background: var(--accent-color);
            color: white;
            font-weight: bold;
            transform: scale(1.05);
        }
        
        .category-btn:hover:not(.active) {
            background: rgba(255,255,255,0.15);
        }
        
        .achievement-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border: 2px solid var(--block-border);
            transition: all 0.3s;
            animation: fadeInUp 0.5s backwards;
            opacity: 0.7;
        }
        
        .achievement-item.unlocked {
            opacity: 1;
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--gold-color);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }
        
        .achievement-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
        }
        
        .achievement-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .achievement-title {
            font-size: 1.2rem;
            color: #4CAF50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .achievement-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            background: rgba(0,0,0,0.3);
            flex-shrink: 0;
        }
        
        .achievement-unlocked-badge {
            background-color: var(--gold-color);
            color: #000;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .achievement-progress {
            margin-top: 10px;
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: #ccc;
        }
        
        .progress-bar-small {
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            border-radius: 4px;
            transition: width 0.3s;
        }
        
        .achievement-description {
            font-size: 0.9rem;
            color: #ccc;
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .achievement-reward {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--gold-color);
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .achievement-hidden {
            filter: blur(5px);
            user-select: none;
        }
        
        .achievement-hidden .achievement-title {
            color: #666;
        }
        
        .achievement-hidden .achievement-description {
            color: #666;
        }
        
        /* Новые стили для сложных достижений */
        .achievement-epic {
            border-color: var(--epic-color) !important;
            background: linear-gradient(45deg, rgba(156, 39, 176, 0.2), rgba(123, 31, 162, 0.1));
        }
        
        .achievement-epic.unlocked {
            border-color: var(--epic-color) !important;
            box-shadow: 0 0 20px rgba(156, 39, 176, 0.5);
            background: linear-gradient(45deg, rgba(156, 39, 176, 0.3), rgba(123, 31, 162, 0.2));
        }
        
        .achievement-legendary {
            border-color: var(--legendary-color) !important;
            background: linear-gradient(45deg, rgba(255, 152, 0, 0.2), rgba(245, 124, 0, 0.1));
        }
        
        .achievement-legendary.unlocked {
            border-color: var(--legendary-color) !important;
            box-shadow: 0 0 20px rgba(255, 152, 0, 0.5);
            background: linear-gradient(45deg, rgba(255, 152, 0, 0.3), rgba(245, 124, 0, 0.2));
        }
        
        .achievement-mythic {
            border-color: var(--mythic-color) !important;
            background: linear-gradient(45deg, rgba(255, 64, 129, 0.2), rgba(194, 24, 91, 0.1));
        }
        
        .achievement-mythic.unlocked {
            border-color: var(--mythic-color) !important;
            box-shadow: 0 0 20px rgba(255, 64, 129, 0.5);
            background: linear-gradient(45deg, rgba(255, 64, 129, 0.3), rgba(194, 24, 91, 0.2));
        }
        
        /* Магазин */
        .shop-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            animation: fadeIn 0.6s;
        }
        
        .shop-items {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .shop-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border: 2px solid var(--block-border);
            transition: all 0.3s;
            animation: fadeInUp 0.5s backwards;
        }
        
        .shop-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .item-title {
            font-size: 1.3rem;
            color: #4CAF50;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: nowrap;
        }
        
        .item-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            background: rgba(0,0,0,0.3);
            flex-shrink: 0;
        }
        
        .item-price {
            color: var(--gold-color);
            font-weight: bold;
            font-size: 1.1rem;
            text-shadow: 1px 1px 0 #000;
            white-space: nowrap;
            margin-left: 10px;
        }
        
        .item-description {
            font-size: 0.9rem;
            color: #ccc;
            margin-bottom: 12px;
            line-height: 1.4;
        }
        
        .item-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 12px;
            font-size: 0.8rem;
            color: #aaa;
            flex-wrap: wrap;
        }
        
        .buy-btn {
            background: linear-gradient(45deg, var(--primary-color), #388E3C);
            color: white;
            border: none;
            padding: 10px 20px;
            width: 100%;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 0 #2E7D32;
        }
        
        .buy-btn:disabled {
            background: linear-gradient(45deg, #757575, #616161);
            cursor: not-allowed;
            opacity: 0.7;
            transform: none !important;
            box-shadow: 0 4px 0 #424242;
        }
        
        .buy-btn:not(:disabled):hover {
            background: linear-gradient(45deg, #66BB6A, #43A047);
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #2E7D32;
        }
        
        .buy-btn:not(:disabled):active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #2E7D32;
        }
        
        .owned-badge {
            background-color: var(--secondary-color);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .item-level {
            color: var(--accent-color);
            font-weight: bold;
            white-space: nowrap;
        }
        
        /* Статистика */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s;
            animation: fadeInUp 0.5s backwards;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-color);
        }
        
        .stat-card-value {
            font-size: 1.8rem;
            color: var(--gold-color);
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-card-label {
            font-size: 0.9rem;
            color: #ccc;
        }
        
        /* Настройки */
        .settings-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }
        
        .setting-item {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            animation: fadeInUp 0.5s backwards;
        }
        
        .setting-title {
            font-size: 1.2rem;
            color: white;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .setting-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
        }
        
        .toggle-checkbox {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        .toggle-checkbox:checked + .toggle-slider {
            background-color: var(--primary-color);
        }
        
        .toggle-checkbox:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        .save-notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--success-color);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 100;
            display: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: slideUp 0.3s, fadeOut 0.3s 1.7s forwards;
        }
        
        /* Титры */
        .credits-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            animation: creditsScroll 30s linear infinite;
        }
        
        .credits-title {
            font-size: 3rem;
            color: var(--gold-color);
            margin-bottom: 40px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .credit-item {
            margin-bottom: 30px;
            opacity: 0;
            animation: fadeInOut 5s linear infinite;
        }
        
        .credit-role {
            font-size: 1.2rem;
            color: #ccc;
            margin-bottom: 5px;
        }
        
        .credit-name {
            font-size: 2rem;
            color: white;
            font-weight: bold;
        }
        
        .final-thanks {
            margin-top: 50px;
            font-size: 2.5rem;
            color: var(--accent-color);
            text-shadow: 0 0 10px rgba(255, 152, 0, 0.5);
            animation: pulse 2s infinite;
        }
        
        .return-btn {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, var(--primary-color), #2E7D32);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            z-index: 20;
            animation: fadeIn 1s 2s backwards;
        }
        
        /* Анимации */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; display: none; }
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translate(-50%, 20px); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes hitEffect {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }
        
        @keyframes regeneratingEffect {
            0% { box-shadow: 0 0 0 rgba(76, 175, 80, 0.5); }
            50% { box-shadow: 0 0 20px rgba(76, 175, 80, 0.8); }
            100% { box-shadow: 0 0 0 rgba(76, 175, 80, 0.5); }
        }
        
        @keyframes breakBlock {
            0% { transform: scale(1); opacity: 1; filter: brightness(1); }
            50% { transform: scale(1.1); opacity: 0.8; filter: brightness(1.5); }
            100% { transform: scale(0); opacity: 0; filter: brightness(2); }
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        @keyframes coinHitFloat {
            0% { 
                transform: translateY(0) scale(1); 
                opacity: 1; 
            }
            50% { 
                transform: translateY(-40px) scale(1.2); 
                opacity: 0.8; 
            }
            100% { 
                transform: translateY(-80px) scale(0.5); 
                opacity: 0; 
            }
        }
        
        @keyframes damageFloat {
            0% { 
                transform: translateY(0) scale(1); 
                opacity: 1; 
            }
            50% { 
                transform: translateY(-30px) scale(1.1); 
                opacity: 0.8; 
            }
            100% { 
                transform: translateY(-60px) scale(0.7); 
                opacity: 0; 
            }
        }
        
        @keyframes coinPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes autoClickerPulse {
            0% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.05); }
            100% { transform: translateX(-50%) scale(1); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes creditsScroll {
            0% { transform: translateY(100%); }
            100% { transform: translateY(-100%); }
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            10%, 90% { opacity: 1; }
        }
        
        /* Модальные окна */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            z-index: 20;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s;
        }
        
        .modal-content {
            background-color: #1b262c;
            padding: 2rem;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 80%;
            overflow-y: auto;
            border: 3px solid var(--primary-color);
            animation: modalAppear 0.4s;
        }
        
        @keyframes modalAppear {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .modal-title {
            font-size: 1.8rem;
            color: var(--gold-color);
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .modal-text {
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 1.5rem;
            color: #ccc;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .modal-btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .modal-btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .modal-btn-secondary {
            background-color: #757575;
            color: white;
        }
        
        /* Фон */
        .minecraft-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255, 255, 255, 0.1) 1px, transparent 1px),
                radial-gradient(circle at 90% 80%, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: 1;
        }
        
        .ground {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 30%;
            background: linear-gradient(to top, #8B4513, #A0522D);
            z-index: 2;
        }
        
        .cloud {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            z-index: 0;
            animation: cloudFloat 60s linear infinite;
        }
        
        .cloud:nth-child(1) {
            width: 100px;
            height: 40px;
            top: 20%;
            left: -100px;
            animation-delay: 0s;
        }
        
        .cloud:nth-child(2) {
            width: 150px;
            height: 60px;
            top: 15%;
            left: -150px;
            animation-delay: 20s;
        }
        
        .cloud:nth-child(3) {
            width: 80px;
            height: 30px;
            top: 30%;
            left: -80px;
            animation-delay: 40s;
        }
        
        @keyframes cloudFloat {
            0% { transform: translateX(0); }
            100% { transform: translateX(calc(100vw + 200px)); }
        }
        
        /* Адаптивность */
        @media (max-width: 500px) {
            .block {
                width: 200px;
                height: 200px;
            }
            
            .menu-title {
                font-size: 2.8rem;
            }
            
            .menu-btn {
                padding: 0.9rem;
                font-size: 1.2rem;
            }
            
            .block-name {
                font-size: 1.7rem;
            }
            
            .game-header {
                padding: 10px;
            }
            
            .coins-container {
                font-size: 1.1rem;
            }
            
            .screen-title {
                font-size: 1.7rem;
            }
            
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .credits-title {
                font-size: 2.2rem;
            }
            
            .credit-name {
                font-size: 1.5rem;
            }
            
            .final-thanks {
                font-size: 1.8rem;
            }
            
            .lucky-notification {
                font-size: 1.5rem;
                padding: 15px 20px;
            }
            
            .item-title {
                font-size: 1.1rem;
                flex-wrap: wrap;
            }
            
            .item-price {
                font-size: 1rem;
            }
        }
        
        /* Новые классы для улучшений */
        .shop-item-level {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 8px;
            flex-wrap: nowrap;
        }
        
        .level-progress {
            flex-grow: 1;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
            min-width: 50px;
        }
        
        .level-progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            border-radius: 3px;
            transition: width 0.3s;
        }
        
        /* Прогресс на панели достижений */
        .progress-achievement {
            display: inline-block;
            background: rgba(255,255,255,0.1);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            margin-left: 10px;
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- Фон -->
        <div class="minecraft-bg"></div>
        <div class="cloud"></div>
        <div class="cloud"></div>
        <div class="cloud"></div>
        <div class="ground"></div>
        
        <!-- Загрузочный экран -->
        <div id="loading-screen">
            <div class="loading-spinner"></div>
            <div class="loading-text">Загрузка игры...</div>
        </div>
        
        <!-- Экран меню -->
        <div id="menu-screen">
            <h1 class="menu-title">MINECRAFT CLICKER PRO</h1>
            <div class="menu-buttons">
                <button class="menu-btn continue-btn" id="continue-btn">
                    <i class="fas fa-play"></i> Продолжить
                </button>
                <button class="menu-btn" id="new-game-btn">
                    <i class="fas fa-plus-circle"></i> Новая игра
                </button>
                <button class="menu-btn stats-btn" id="stats-menu-btn">
                    <i class="fas fa-chart-bar"></i> Статистика
                </button>
                <button class="menu-btn achievements-btn" id="achievements-menu-btn">
                    <i class="fas fa-trophy"></i> Достижения <span id="achievements-count" class="progress-achievement">0/81</span>
                </button>
                <button class="menu-btn" id="shop-menu-btn">
                    <i class="fas fa-shopping-cart"></i> Магазин
                </button>
                <button class="menu-btn settings-btn" id="settings-menu-btn">
                    <i class="fas fa-cog"></i> Настройки
                </button>
            </div>
            <button class="privacy-btn" id="privacy-btn">Конфиденциальность</button>
            <div class="version">Версия 4.0</div>
        </div>
        
        <!-- Игровой экран -->
        <div id="game-screen">
            <div class="game-header">
                <div class="coins-container">
                    <div class="coin-icon"></div>
                    <span id="coins-counter">0</span>
                </div>
                <div class="stage-container">
                    <i class="fas fa-layer-group"></i>
                    <span id="stage-counter">Стадия 1</span>
                </div>
                <div class="game-buttons">
                    <button class="game-header-btn" id="game-shop-btn" title="Магазин">
                        <i class="fas fa-shopping-cart"></i>
                    </button>
                    <button class="game-header-btn" id="game-stats-btn" title="Статистика">
                        <i class="fas fa-chart-bar"></i>
                    </button>
                    <button class="game-header-btn" id="game-menu-btn" title="Меню">
                        <i class="fas fa-home"></i>
                    </button>
                </div>
            </div>
            
            <div class="block-info-container">
                <div class="block-name" id="block-name">Земля</div>
                <div class="block-type" id="block-type">Базовый блок</div>
                <div class="health-container">
                    <i class="fas fa-heart health-icon"></i>
                    <div class="health-display" id="health-display">15/15</div>
                </div>
            </div>
            
            <div class="block-container">
                <div class="block" id="block">
                    <img src="" alt="Блок" class="block-img" id="block-img">
                    <div class="cracks-overlay" id="cracks-overlay"></div>
                    <div class="regeneration-indicator" id="regeneration-indicator">Регенерация!</div>
                </div>
            </div>
            
            <div class="progress-bar-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            
            <div class="game-stats">
                <div class="stat-item">
                    <div class="stat-value" id="dps-counter">0</div>
                    <div class="stat-label">УВС</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="total-clicks">0</div>
                    <div class="stat-label">Кликов</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="blocks-broken">0</div>
                    <div class="stat-label">Блоков</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="play-time">0:00</div>
                    <div class="stat-label">Время</div>
                </div>
            </div>
            
            <div class="auto-clicker-info" id="auto-clicker-info"></div>
        </div>
        
        <!-- Магазин -->
        <div id="shop-screen">
            <div class="screen-header">
                <h2 class="screen-title">Магазин</h2>
                <button class="back-btn" id="shop-back-btn">
                    <i class="fas fa-arrow-left"></i> Назад
                </button>
            </div>
            
            <div class="shop-categories">
                <button class="category-btn active" data-category="all">Все</button>
                <button class="category-btn" data-category="clickers">Автокликеры (7 ур.)</button>
                <button class="category-btn" data-category="boosters">Бустеры (7 ур.)</button>
                <button class="category-btn" data-category="additional">Дополнительно</button>
                <button class="category-btn" data-category="premium">Премиум</button>
            </div>
            
            <div class="shop-items" id="shop-items-container">
                <!-- Товары будут загружены через JavaScript -->
            </div>
        </div>
        
        <!-- Статистика -->
        <div id="stats-screen">
            <div class="screen-header">
                <h2 class="screen-title">Статистика</h2>
                <button class="back-btn" id="stats-back-btn">
                    <i class="fas fa-arrow-left"></i> Назад
                </button>
            </div>
            
            <div class="stats-container" id="stats-container">
                <!-- Статистика будет загружена через JavaScript -->
            </div>
        </div>
        
        <!-- ДОСТИЖЕНИЯ -->
        <div id="achievements-screen">
            <div class="screen-header">
                <h2 class="screen-title">Достижения <span id="total-achievements" style="font-size: 1.2rem;">(0/81)</span></h2>
                <button class="back-btn" id="achievements-back-btn">
                    <i class="fas fa-arrow-left"></i> Назад
                </button>
            </div>
            
            <div class="achievement-categories">
                <button class="category-btn active" data-category="all">Все</button>
                <button class="category-btn" data-category="blocks">Блоки</button>
                <button class="category-btn" data-category="coins">Монеты</button>
                <button class="category-btn" data-category="combat">Бой</button>
                <button class="category-btn" data-category="shop">Магазин</button>
                <button class="category-btn" data-category="misc">Разное</button>
                <button class="category-btn" data-category="advanced">Сложные</button>
                <button class="category-btn" data-category="secret">Секретные</button>
            </div>
            
            <div class="achievements-container" id="achievements-container">
                <!-- Достижения будут загружены через JavaScript -->
            </div>
        </div>
        
        <!-- Настройки -->
        <div id="settings-screen">
            <div class="screen-header">
                <h2 class="screen-title">Настройки</h2>
                <button class="back-btn" id="settings-back-btn">
                    <i class="fas fa-arrow-left"></i> Назад
                </button>
            </div>
            
            <div class="settings-container">
                <div class="setting-item">
                    <div class="setting-title">
                        <i class="fas fa-volume-up"></i>
                        Звуковые эффекты
                    </div>
                    <div class="setting-controls">
                        <label class="toggle-switch">
                            <input type="checkbox" id="sound-toggle" class="toggle-checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-title">
                        <i class="fas fa-bell"></i>
                        Уведомления
                    </div>
                    <div class="setting-controls">
                        <label class="toggle-switch">
                            <input type="checkbox" id="notifications-toggle" class="toggle-checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-title">
                        <i class="fas fa-save"></i>
                        Автосохранение
                    </div>
                    <div class="setting-controls">
                        <label class="toggle-switch">
                            <input type="checkbox" id="autosave-toggle" class="toggle-checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-title">
                        <i class="fas fa-palette"></i>
                        Анимации
                    </div>
                    <div class="setting-controls">
                        <label class="toggle-switch">
                            <input type="checkbox" id="animations-toggle" class="toggle-checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-title">
                        <i class="fas fa-trash"></i>
                        Управление данными
                    </div>
                    <div class="setting-controls">
                        <button class="menu-btn" id="clear-data-btn" style="padding: 8px 15px; font-size: 0.9rem;">
                            <i class="fas fa-trash-alt"></i> Очистить данные
                        </button>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-title">
                        <i class="fas fa-info-circle"></i>
                        О игре
                    </div>
                    <div class="setting-controls">
                        <button class="menu-btn" id="about-btn" style="padding: 8px 15px; font-size: 0.9rem;">
                            <i class="fas fa-info"></i> Информация
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Титры -->
        <div id="credits-screen">
            <div class="screen-header">
                <h2 class="screen-title">Титры</h2>
            </div>
            
            <div class="credits-content" id="credits-content">
                <div class="credits-title">Minecraft Clicker Pro</div>
                
                <div class="credit-item" style="animation-delay: 0s;">
                    <div class="credit-role">Автор игры</div>
                    <div class="credit-name">Данил Фардтдинов</div>
                </div>
                
                <div class="credit-item" style="animation-delay: 3s;">
                    <div class="credit-role">Идея игры</div>
                    <div class="credit-name">Данила Фардтдинов</div>
                </div>
                
                <div class="credit-item" style="animation-delay: 6s;">
                    <div class="credit-role">Разработка</div>
                    <div class="credit-name">Данила Фардтдинов</div>
                </div>
                
                <div class="credit-item" style="animation-delay: 9s;">
                    <div class="credit-role">Дизайн</div>
                    <div class="credit-name">Данила Фардтдинов</div>
                </div>
                
                <div class="credit-item" style="animation-delay: 12s;">
                    <div class="credit-role">Программирование</div>
                    <div class="credit-name">Данила Фардтдинов</div>
                </div>
                
                <div class="credit-item" style="animation-delay: 15s;">
                    <div class="credit-role">Тестирование</div>
                    <div class="credit-name">Данила Фардтдинов</div>
                </div>
                
                <div class="credit-item" style="animation-delay: 18s;">
                    <div class="credit-role">Звуковое оформление</div>
                    <div class="credit-name">Данила Фардтдинов</div>
                </div>
                
                <div class="credit-item" style="animation-delay: 21s;">
                    <div class="credit-role">Геймдизайн</div>
                    <div class="credit-name">Данила Фардтдинов</div>
                </div>
                
                <div class="credit-item" style="animation-delay: 24s;">
                    <div class="credit-role">Продюсирование</div>
                    <div class="credit-name">Данила Фардтдинов</div>
                </div>
                
                <div class="final-thanks">СПАСИБО ЗА ВНИМАНИЕ!</div>
            </div>
            
            <button class="return-btn" id="credits-back-btn">
                <i class="fas fa-home"></i> Вернуться в меню
            </button>
        </div>
        
        <!-- Модальные окна -->
        <div class="modal" id="privacy-modal">
            <div class="modal-content">
                <h2 class="modal-title">Политика конфиденциальности</h2>
                <div class="modal-text">
                    <p><strong>Minecraft Clicker Pro</strong> - это браузерная игра, которая работает полностью локально на вашем устройстве.</p>
                    
                    <h3 style="color: var(--gold-color); margin-top: 15px;">Какие данные мы собираем?</h3>
                    <p>✅ <strong>Никакие данные не собираются</strong> - игра не отправляет информацию на серверы</p>
                    <p>✅ Все данные хранятся только в вашем браузере</p>
                    <p>✅ Игра не требует подключения к интернету после загрузки</p>
                    
                    <h3 style="color: var(--gold-color); margin-top: 15px;">Что сохраняется локально?</h3>
                    <p>• Прогресс игры (монеты, улучшения, статистика)</p>
                    <p>• Настройки игры</p>
                    <p>• Приобретенные предметы в магазине</p>
                    <p>• Полученные достижения</p>
                    
                    <h3 style="color: var(--gold-color); margin-top: 15px;">Как удалить данные?</h3>
                    <p>Вы можете очистить данные игры в настройках или очистить кэш браузера.</p>
                    
                    <p style="margin-top: 20px; font-size: 0.9rem; color: #aaa;">
                        Версия игры: 4.0<br>
                        Последнее обновление: 2024
                    </p>
                </div>
                <div class="modal-buttons">
                    <button class="modal-btn modal-btn-primary" id="close-modal-btn">Закрыть</button>
                </div>
            </div>
        </div>
        
        <div class="modal" id="new-game-modal">
            <div class="modal-content">
                <h2 class="modal-title">Новая игра</h2>
                <div class="modal-text">
                    <p>Вы уверены, что хотите начать новую игру?</p>
                    <p><strong>Текущий прогресс будет удален!</strong></p>
                    <p style="color: var(--accent-color); font-size: 0.9rem;">
                        <i class="fas fa-exclamation-triangle"></i> Это действие нельзя отменить
                    </p>
                </div>
                <div class="modal-buttons">
                    <button class="modal-btn modal-btn-primary" id="confirm-new-game-btn">Начать новую игру</button>
                    <button class="modal-btn modal-btn-secondary" id="cancel-new-game-btn">Отмена</button>
                </div>
            </div>
        </div>
        
        <div class="modal" id="clear-data-modal">
            <div class="modal-content">
                <h2 class="modal-title">Очистка данных</h2>
                <div class="modal-text">
                    <p>Вы уверены, что хотите удалить все данные игры?</p>
                    <p><strong>Будет удалено:</strong></p>
                    <ul style="margin-left: 20px; margin-bottom: 15px;">
                        <li>Весь прогресс игры</li>
                        <li>Все монеты и улучшения</li>
                        <li>Всю статистику</li>
                        <li>Все достижения</li>
                        <li>Все настройки</li>
                    </ul>
                    <p style="color: var(--danger-color); font-size: 0.9rem;">
                        <i class="fas fa-exclamation-triangle"></i> Это действие нельзя отменить!
                    </p>
                </div>
                <div class="modal-buttons">
                    <button class="modal-btn modal-btn-primary" id="confirm-clear-data-btn">Удалить все данные</button>
                    <button class="modal-btn modal-btn-secondary" id="cancel-clear-data-btn">Отмена</button>
                </div>
            </div>
        </div>
        
        <div class="modal" id="about-modal">
            <div class="modal-content">
                <h2 class="modal-title">О игре</h2>
                <div class="modal-text">
                    <p><strong>Minecraft Clicker Pro v4.0</strong> - улучшенная версия классического кликера с тематикой Minecraft.</p>
                    
                    <h3 style="color: var(--gold-color); margin-top: 15px;">Новые функции в версии 4.0:</h3>
                    <ul style="margin-left: 20px; margin-bottom: 15px;">
                        <li>81 достижение с реальным отслеживанием прогресса</li>
                        <li>Автокликеры до 7 уровня</li>
                        <li>Бустеры силы удара до 7 уровня</li>
                        <li>Бустеры удачи до 7 уровня</li>
                        <li>Секретный Lucky Block с шансом 0.2%</li>
                        <li>Система стадий вместо уровней</li>
                        <li>15 новых предметов в магазине</li>
                        <li>Улучшенная графика и анимации</li>
                        <li>Индикаторы прогресса достижений</li>
                    </ul>
                    
                    <h3 style="color: var(--gold-color); margin-top: 15px;">Управление:</h3>
                    <p>• Кликайте по блоку для его разрушения</p>
                    <p>• Зарабатывайте монеты за разрушение блоков</p>
                    <p>• Покупайте автокликеры и бустеры в магазине</p>
                    <p>• Собирайте достижения за различные игровые действия</p>
                    <p>• Ищите редкий Lucky Block для бонусных монет</p>
                    
                    <p style="margin-top: 20px; font-size: 0.9rem; color: #aaa;">
                        Версия: 4.0<br>
                        Автор: Данил Фардтдинов<br>
                        Идея: Данила Фардтдинов<br>
                        Создано с использованием HTML5, CSS3 и JavaScript
                    </p>
                </div>
                <div class="modal-buttons">
                    <button class="modal-btn modal-btn-primary" id="close-about-modal-btn">Закрыть</button>
                </div>
            </div>
        </div>
        
        <!-- Lucky Block уведомление -->
        <div class="lucky-notification" id="lucky-notification">
            <i class="fas fa-star"></i><br>
            LUCKY BLOCK!<br>
            <span style="font-size: 1.2rem;">+5,000 монет</span>
        </div>
        
        <!-- Уведомление о сохранении -->
        <div class="save-notification" id="save-notification">
            <i class="fas fa-check-circle"></i> Игра сохранена!
        </div>
        
        <!-- Уведомление о достижении -->
        <div class="save-notification" id="achievement-notification" style="background: linear-gradient(45deg, #FF9800, #F57C00); top: 20px; bottom: auto;">
            <i class="fas fa-trophy"></i> Новое достижение!
        </div>
        
        <!-- Уведомление о сложном достижении -->
        <div class="save-notification" id="epic-achievement-notification" style="background: linear-gradient(45deg, #9C27B0, #7B1FA2); top: 60px; bottom: auto;">
            <i class="fas fa-crown"></i> Эпическое достижение!
        </div>
    </div>

    <script>
        // ============================
        // ОСНОВНЫЕ ПЕРЕМЕННЫЕ
        // ============================
        
        const SAVE_VERSION = '4.0';
        
        // Элементы DOM
        const loadingScreen = document.getElementById('loading-screen');
        const menuScreen = document.getElementById('menu-screen');
        const gameScreen = document.getElementById('game-screen');
        const shopScreen = document.getElementById('shop-screen');
        const statsScreen = document.getElementById('stats-screen');
        const settingsScreen = document.getElementById('settings-screen');
        const creditsScreen = document.getElementById('credits-screen');
        const achievementsScreen = document.getElementById('achievements-screen');
        const luckyNotification = document.getElementById('lucky-notification');
        const achievementNotification = document.getElementById('achievement-notification');
        const epicAchievementNotification = document.getElementById('epic-achievement-notification');
        
        // ============================
        // СИСТЕМА ДОСТИЖЕНИЙ (81 ДОСТИЖЕНИЕ)
        // ============================
        
        const achievementsData = [
            // ============================
            // 40 СТАРЫХ ДОСТИЖЕНИЙ
            // ============================
            
            // Категория: Блоки
            {
                id: 'first_block',
                name: 'Первая добыча',
                description: 'Разрушь свой первый блок',
                category: 'blocks',
                icon: 'fas fa-gem',
                iconColor: '#4CAF50',
                requirement: { type: 'blocks_broken', value: 1 },
                reward: { coins: 100, multiplier: 1 },
                hidden: false
            },
            {
                id: 'block_10',
                name: 'Начинающий шахтер',
                description: 'Разрушь 10 блоков',
                category: 'blocks',
                icon: 'fas fa-hammer',
                iconColor: '#4CAF50',
                requirement: { type: 'blocks_broken', value: 10 },
                reward: { coins: 200, multiplier: 1 },
                hidden: false
            },
            {
                id: 'block_50',
                name: 'Опытный шахтер',
                description: 'Разрушь 50 блоков',
                category: 'blocks',
                icon: 'fas fa-hammer',
                iconColor: '#FF9800',
                requirement: { type: 'blocks_broken', value: 50 },
                reward: { coins: 500, multiplier: 1.1 },
                hidden: false
            },
            {
                id: 'block_100',
                name: 'Мастер шахтер',
                description: 'Разрушь 100 блоков',
                category: 'blocks',
                icon: 'fas fa-gem',
                iconColor: '#FF9800',
                requirement: { type: 'blocks_broken', value: 100 },
                reward: { coins: 1000, multiplier: 1.1 },
                hidden: false
            },
            {
                id: 'block_500',
                name: 'Легендарный шахтер',
                description: 'Разрушь 500 блоков',
                category: 'blocks',
                icon: 'fas fa-crown',
                iconColor: '#FFD700',
                requirement: { type: 'blocks_broken', value: 500 },
                reward: { coins: 5000, multiplier: 1.2 },
                hidden: false
            },
            {
                id: 'lucky_block',
                name: 'Счастливчик',
                description: 'Найди Lucky Block',
                category: 'blocks',
                icon: 'fas fa-star',
                iconColor: '#FFEB3B',
                requirement: { type: 'lucky_blocks', value: 1 },
                reward: { coins: 5000, multiplier: 1.2 },
                hidden: false
            },
            {
                id: 'fast_breaker',
                name: 'Быстрый разрушитель',
                description: 'Разрушь блок менее чем за 3 секунды',
                category: 'blocks',
                icon: 'fas fa-bolt',
                iconColor: '#F44336',
                requirement: { type: 'fast_block_break', value: 1 },
                reward: { coins: 1000, multiplier: 1.1 },
                hidden: false
            },
            
            // Категория: Монеты
            {
                id: 'coins_100',
                name: 'Первые монеты',
                description: 'Заработай 100 монет',
                category: 'coins',
                icon: 'fas fa-coins',
                iconColor: '#FFD700',
                requirement: { type: 'total_coins', value: 100 },
                reward: { coins: 50, multiplier: 1 },
                hidden: false
            },
            {
                id: 'coins_1000',
                name: 'Начинающий богач',
                description: 'Заработай 1,000 монет',
                category: 'coins',
                icon: 'fas fa-piggy-bank',
                iconColor: '#FFD700',
                requirement: { type: 'total_coins', value: 1000 },
                reward: { coins: 200, multiplier: 1 },
                hidden: false
            },
            {
                id: 'coins_10000',
                name: 'Состоятельный',
                description: 'Заработай 10,000 монет',
                category: 'coins',
                icon: 'fas fa-gem',
                iconColor: '#FFD700',
                requirement: { type: 'total_coins', value: 10000 },
                reward: { coins: 1000, multiplier: 1.1 },
                hidden: false
            },
            {
                id: 'coins_50000',
                name: 'Богатый',
                description: 'Заработай 50,000 монет',
                category: 'coins',
                icon: 'fas fa-money-bill-wave',
                iconColor: '#FFD700',
                requirement: { type: 'total_coins', value: 50000 },
                reward: { coins: 5000, multiplier: 1.2 },
                hidden: false
            },
            {
                id: 'coins_100000',
                name: 'Миллионер',
                description: 'Заработай 100,000 монет',
                category: 'coins',
                icon: 'fas fa-crown',
                iconColor: '#FFD700',
                requirement: { type: 'total_coins', value: 100000 },
                reward: { coins: 10000, multiplier: 1.2 },
                hidden: false
            },
            
            // Категория: Бой
            {
                id: 'click_10',
                name: 'Первый кликер',
                description: 'Сделай 10 кликов',
                category: 'combat',
                icon: 'fas fa-mouse-pointer',
                iconColor: '#4CAF50',
                requirement: { type: 'total_clicks', value: 10 },
                reward: { coins: 50, multiplier: 1 },
                hidden: false
            },
            {
                id: 'click_100',
                name: 'Начинающий кликер',
                description: 'Сделай 100 кликов',
                category: 'combat',
                icon: 'fas fa-hand-pointer',
                iconColor: '#4CAF50',
                requirement: { type: 'total_clicks', value: 100 },
                reward: { coins: 200, multiplier: 1 },
                hidden: false
            },
            {
                id: 'click_1000',
                name: 'Профессиональный кликер',
                description: 'Сделай 1,000 кликов',
                category: 'combat',
                icon: 'fas fa-mouse',
                iconColor: '#2196F3',
                requirement: { type: 'total_clicks', value: 1000 },
                reward: { coins: 1000, multiplier: 1.1 },
                hidden: false
            },
            {
                id: 'click_10000',
                name: 'Мастер кликов',
                description: 'Сделай 10,000 кликов',
                category: 'combat',
                icon: 'fas fa-bullseye',
                iconColor: '#FF9800',
                requirement: { type: 'total_clicks', value: 10000 },
                reward: { coins: 5000, multiplier: 1.2 },
                hidden: false
            },
            {
                id: 'damage_1000',
                name: 'Наносящий урон',
                description: 'Нанеси 1,000 урона',
                category: 'combat',
                icon: 'fas fa-fist-raised',
                iconColor: '#F44336',
                requirement: { type: 'total_damage', value: 1000 },
                reward: { coins: 500, multiplier: 1.1 },
                hidden: false
            },
            {
                id: 'damage_10000',
                name: 'Мастер урона',
                description: 'Нанеси 10,000 урона',
                category: 'combat',
                icon: 'fas fa-crosshairs',
                iconColor: '#F44336',
                requirement: { type: 'total_damage', value: 10000 },
                reward: { coins: 2500, multiplier: 1.1 },
                hidden: false
            },
            {
                id: 'critical_10',
                name: 'Критический удар',
                description: 'Нанеси 10 критических ударов',
                category: 'combat',
                icon: 'fas fa-bolt',
                iconColor: '#FFD700',
                requirement: { type: 'critical_hits', value: 10 },
                reward: { coins: 500, multiplier: 1.1 },
                hidden: false
            },
            
            // Категория: Магазин
            {
                id: 'first_purchase',
                name: 'Первая покупка',
                description: 'Купи первый предмет в магазине',
                category: 'shop',
                icon: 'fas fa-shopping-cart',
                iconColor: '#4CAF50',
                requirement: { type: 'items_purchased', value: 1 },
                reward: { coins: 500, multiplier: 1 },
                hidden: false
            },
            {
                id: 'shop_5',
                name: 'Шопоголик',
                description: 'Купи 5 предметов в магазине',
                category: 'shop',
                icon: 'fas fa-shopping-bag',
                iconColor: '#9C27B0',
                requirement: { type: 'items_purchased', value: 5 },
                reward: { coins: 1000, multiplier: 1.1 },
                hidden: false
            },
            {
                id: 'shop_10',
                name: 'Верный покупатель',
                description: 'Купи 10 предметов в магазине',
                category: 'shop',
                icon: 'fas fa-shopping-basket',
                iconColor: '#9C27B0',
                requirement: { type: 'items_purchased', value: 10 },
                reward: { coins: 2000, multiplier: 1.1 },
                hidden: false
            },
            {
                id: 'auto_clicker',
                name: 'Автоматизация',
                description: 'Приобрети первый автокликер',
                category: 'shop',
                icon: 'fas fa-robot',
                iconColor: '#2196F3',
                requirement: { type: 'auto_clicker_purchased', value: 1 },
                reward: { coins: 1000, multiplier: 1.1 },
                hidden: false
            },
            {
                id: 'max_upgrade',
                name: 'Максимальное улучшение',
                description: 'Улучши предмет до максимального уровня',
                category: 'shop',
                icon: 'fas fa-arrow-up',
                iconColor: '#FF9800',
                requirement: { type: 'max_upgrade', value: 1 },
                reward: { coins: 2000, multiplier: 1.2 },
                hidden: false
            },
            
            // Категория: Разное
            {
                id: 'play_5min',
                name: 'Пять минут игры',
                description: 'Играй 5 минут',
                category: 'misc',
                icon: 'fas fa-clock',
                iconColor: '#2196F3',
                requirement: { type: 'play_time', value: 300 },
                reward: { coins: 200, multiplier: 1 },
                hidden: false
            },
            {
                id: 'play_30min',
                name: 'Полчаса в игре',
                description: 'Играй 30 минут',
                category: 'misc',
                icon: 'fas fa-hourglass',
                iconColor: '#FF9800',
                requirement: { type: 'play_time', value: 1800 },
                reward: { coins: 1000, multiplier: 1.1 },
                hidden: false
            },
            {
                id: 'play_2h',
                name: 'Два часа в игре',
                description: 'Играй 2 часа',
                category: 'misc',
                icon: 'fas fa-hourglass-half',
                iconColor: '#9C27B0',
                requirement: { type: 'play_time', value: 7200 },
                reward: { coins: 5000, multiplier: 1.2 },
                hidden: false
            },
            {
                id: 'stage_5',
                name: 'Покоритель стадий',
                description: 'Достигни 5 стадии',
                category: 'misc',
                icon: 'fas fa-layer-group',
                iconColor: '#9C27B0',
                requirement: { type: 'stage_reached', value: 5 },
                reward: { coins: 2000, multiplier: 1.1 },
                hidden: false
            },
            {
                id: 'stage_10',
                name: 'Мастер стадий',
                description: 'Достигни 10 стадии',
                category: 'misc',
                icon: 'fas fa-trophy',
                iconColor: '#FFD700',
                requirement: { type: 'stage_reached', value: 10 },
                reward: { coins: 5000, multiplier: 1.2 },
                hidden: false
            },
            {
                id: 'stage_20',
                name: 'Легенда стадий',
                description: 'Достигни 20 стадии',
                category: 'misc',
                icon: 'fas fa-crown',
                iconColor: '#FFD700',
                requirement: { type: 'stage_reached', value: 20 },
                reward: { coins: 10000, multiplier: 1.3 },
                hidden: false
            },
            
            // Категория: Секретные
            {
                id: 'combo_20',
                name: 'Мастер комбо',
                description: 'Сделай 20 кликов подряд',
                category: 'secret',
                icon: 'fas fa-fire',
                iconColor: '#FF5722',
                requirement: { type: 'combo', value: 20 },
                reward: { coins: 1000, multiplier: 1.2 },
                hidden: true
            },
            {
                id: 'perfect_hit',
                name: 'Идеальный удар',
                description: 'Уничтожь блок с полным здоровьем за один удар',
                category: 'secret',
                icon: 'fas fa-check-circle',
                iconColor: '#4CAF50',
                requirement: { type: 'perfect_hit', value: 1 },
                reward: { coins: 2000, multiplier: 1.1 },
                hidden: true
            },
            {
                id: 'all_blocks',
                name: 'Коллекционер',
                description: 'Разрушь 15 разных типов блоков',
                category: 'secret',
                icon: 'fas fa-layer-group',
                iconColor: '#673AB7',
                requirement: { type: 'all_blocks', value: 15 },
                reward: { coins: 3000, multiplier: 1.2 },
                hidden: true
            },
            
            // ============================
            // 41 НОВЫХ СЛОЖНЫХ ДОСТИЖЕНИЯ
            // ============================
            
            // Категория: Advanced - Эпические вызовы
            {
                id: 'block_1000',
                name: 'Великий разрушитель',
                description: 'Разрушь 1,000 блоков',
                category: 'advanced',
                icon: 'fas fa-mountain',
                iconColor: '#9C27B0',
                requirement: { type: 'blocks_broken', value: 1000 },
                reward: { coins: 10000, multiplier: 1.3 },
                hidden: false,
                difficulty: 'epic'
            },
            {
                id: 'block_5000',
                name: 'Неутомимый шахтер',
                description: 'Разрушь 5,000 блоков',
                category: 'advanced',
                icon: 'fas fa-digging',
                iconColor: '#9C27B0',
                requirement: { type: 'blocks_broken', value: 5000 },
                reward: { coins: 50000, multiplier: 1.4 },
                hidden: false,
                difficulty: 'epic'
            },
            {
                id: 'coins_1m',
                name: 'Магнат',
                description: 'Заработай 1,000,000 монет',
                category: 'advanced',
                icon: 'fas fa-money-check-alt',
                iconColor: '#FFD700',
                requirement: { type: 'total_coins', value: 1000000 },
                reward: { coins: 100000, multiplier: 1.5 },
                hidden: false,
                difficulty: 'legendary'
            },
            {
                id: 'coins_10m',
                name: 'Империя',
                description: 'Заработай 10,000,000 монет',
                category: 'advanced',
                icon: 'fas fa-crown',
                iconColor: '#FFD700',
                requirement: { type: 'total_coins', value: 10000000 },
                reward: { coins: 500000, multiplier: 2.0 },
                hidden: false,
                difficulty: 'mythic'
            },
            {
                id: 'click_100k',
                name: 'Неутомимый палец',
                description: 'Сделай 100,000 кликов',
                category: 'advanced',
                icon: 'fas fa-hand-sparkles',
                iconColor: '#2196F3',
                requirement: { type: 'total_clicks', value: 100000 },
                reward: { coins: 50000, multiplier: 1.4 },
                hidden: false,
                difficulty: 'epic'
            },
            {
                id: 'click_1m',
                name: 'Кликовый бог',
                description: 'Сделай 1,000,000 кликов',
                category: 'advanced',
                icon: 'fas fa-hand-rock',
                iconColor: '#2196F3',
                requirement: { type: 'total_clicks', value: 1000000 },
                reward: { coins: 250000, multiplier: 1.8 },
                hidden: false,
                difficulty: 'legendary'
            },
            {
                id: 'damage_1m',
                name: 'Разрушитель миров',
                description: 'Нанеси 1,000,000 урона',
                category: 'advanced',
                icon: 'fas fa-skull-crossbones',
                iconColor: '#F44336',
                requirement: { type: 'total_damage', value: 1000000 },
                reward: { coins: 100000, multiplier: 1.6 },
                hidden: false,
                difficulty: 'legendary'
            },
            {
                id: 'damage_10m',
                name: 'Апокалипсис',
                description: 'Нанеси 10,000,000 урона',
                category: 'advanced',
                icon: 'fas fa-meteor',
                iconColor: '#F44336',
                requirement: { type: 'total_damage', value: 10000000 },
                reward: { coins: 500000, multiplier: 2.0 },
                hidden: false,
                difficulty: 'mythic'
            },
            
            // Категория: Advanced - Монстры прогресса
            {
                id: 'stage_50',
                name: 'Повелитель стадий',
                description: 'Достигни 50 стадии',
                category: 'advanced',
                icon: 'fas fa-chess-queen',
                iconColor: '#9C27B0',
                requirement: { type: 'stage_reached', value: 50 },
                reward: { coins: 50000, multiplier: 1.5 },
                hidden: false,
                difficulty: 'legendary'
            },
            {
                id: 'stage_100',
                name: 'Бессмертный',
                description: 'Достигни 100 стадии',
                category: 'advanced',
                icon: 'fas fa-infinity',
                iconColor: '#FF4081',
                requirement: { type: 'stage_reached', value: 100 },
                reward: { coins: 250000, multiplier: 2.0 },
                hidden: false,
                difficulty: 'mythic'
            },
            {
                id: 'play_24h',
                name: 'Суточный марафон',
                description: 'Играй 24 часа',
                category: 'advanced',
                icon: 'fas fa-calendar-day',
                iconColor: '#FF9800',
                requirement: { type: 'play_time', value: 86400 },
                reward: { coins: 50000, multiplier: 1.4 },
                hidden: false,
                difficulty: 'epic'
            },
            {
                id: 'play_7d',
                name: 'Неделя в шахте',
                description: 'Играй 7 дней',
                category: 'advanced',
                icon: 'fas fa-calendar-week',
                iconColor: '#9C27B0',
                requirement: { type: 'play_time', value: 604800 },
                reward: { coins: 150000, multiplier: 1.7 },
                hidden: false,
                difficulty: 'legendary'
            },
            {
                id: 'play_30d',
                name: 'Месяц посвящения',
                description: 'Играй 30 дней',
                category: 'advanced',
                icon: 'fas fa-calendar-alt',
                iconColor: '#FF4081',
                requirement: { type: 'play_time', value: 2592000 },
                reward: { coins: 500000, multiplier: 2.0 },
                hidden: false,
                difficulty: 'mythic'
            },
            
            // Категория: Advanced - Мастерство
            {
                id: 'critical_1000',
                name: 'Критический гений',
                description: 'Нанеси 1,000 критических ударов',
                category: 'advanced',
                icon: 'fas fa-bolt',
                iconColor: '#FFD700',
                requirement: { type: 'critical_hits', value: 1000 },
                reward: { coins: 25000, multiplier: 1.3 },
                hidden: false,
                difficulty: 'epic'
            },
            {
                id: 'critical_10000',
                name: 'Мастер критов',
                description: 'Нанеси 10,000 критических ударов',
                category: 'advanced',
                icon: 'fas fa-bolt',
                iconColor: '#FF9800',
                requirement: { type: 'critical_hits', value: 10000 },
                reward: { coins: 100000, multiplier: 1.6 },
                hidden: false,
                difficulty: 'legendary'
            },
            {
                id: 'combo_100',
                name: 'Непрерывный поток',
                description: 'Сделай 100 кликов подряд',
                category: 'advanced',
                icon: 'fas fa-wave-square',
                iconColor: '#FF5722',
                requirement: { type: 'combo', value: 100 },
                reward: { coins: 10000, multiplier: 1.3 },
                hidden: false,
                difficulty: 'epic'
            },
            {
                id: 'combo_500',
                name: 'Божественное комбо',
                description: 'Сделай 500 кликов подряд',
                category: 'advanced',
                icon: 'fas fa-fire-alt',
                iconColor: '#FF5722',
                requirement: { type: 'combo', value: 500 },
                reward: { coins: 50000, multiplier: 1.6 },
                hidden: false,
                difficulty: 'legendary'
            },
            {
                id: 'perfect_50',
                name: 'Совершенство',
                description: 'Сделай 50 идеальных ударов',
                category: 'advanced',
                icon: 'fas fa-star',
                iconColor: '#4CAF50',
                requirement: { type: 'perfect_hit', value: 50 },
                reward: { coins: 20000, multiplier: 1.4 },
                hidden: false,
                difficulty: 'epic'
            },
            {
                id: 'perfect_500',
                name: 'Абсолютная точность',
                description: 'Сделай 500 идеальных ударов',
                category: 'advanced',
                icon: 'fas fa-bullseye',
                iconColor: '#4CAF50',
                requirement: { type: 'perfect_hit', value: 500 },
                reward: { coins: 100000, multiplier: 1.8 },
                hidden: false,
                difficulty: 'legendary'
            },
            {
                id: 'fast_100',
                name: 'Скоростной демон',
                description: 'Разрушь 100 блоков менее чем за 3 секунды',
                category: 'advanced',
                icon: 'fas fa-running',
                iconColor: '#F44336',
                requirement: { type: 'fast_block_break', value: 100 },
                reward: { coins: 15000, multiplier: 1.3 },
                hidden: false,
                difficulty: 'epic'
            },
            {
                id: 'fast_1000',
                name: 'Молниеносный',
                description: 'Разрушь 1,000 блоков менее чем за 3 секунды',
                category: 'advanced',
                icon: 'fas fa-bolt',
                iconColor: '#F44336',
                requirement: { type: 'fast_block_break', value: 1000 },
                reward: { coins: 75000, multiplier: 1.6 },
                hidden: false,
                difficulty: 'legendary'
            },
            
            // Категория: Advanced - Коллекционер
            {
                id: 'all_blocks_35',
                name: 'Энциклопедист',
                description: 'Разрушь все 35 типов блоков',
                category: 'advanced',
                icon: 'fas fa-book',
                iconColor: '#673AB7',
                requirement: { type: 'all_blocks', value: 35 },
                reward: { coins: 50000, multiplier: 1.5 },
                hidden: false,
                difficulty: 'legendary'
            },
            {
                id: 'block_10k_each',
                name: 'Одержимый коллекционер',
                description: 'Разрушь по 10,000 каждого типа блоков',
                category: 'advanced',
                icon: 'fas fa-layer-group',
                iconColor: '#FF4081',
                requirement: { type: 'blocks_10k_each', value: 1 },
                reward: { coins: 500000, multiplier: 2.0 },
                hidden: true,
                difficulty: 'mythic'
            },
            
            // Категория: Advanced - Магазин и улучшения
            {
                id: 'shop_50',
                name: 'Владелец магазина',
                description: 'Купи 50 предметов в магазине',
                category: 'advanced',
                icon: 'fas fa-store',
                iconColor: '#9C27B0',
                requirement: { type: 'items_purchased', value: 50 },
                reward: { coins: 25000, multiplier: 1.4 },
                hidden: false,
                difficulty: 'epic'
            },
            {
                id: 'shop_100',
                name: 'Магнат покупок',
                description: 'Купи 100 предметов в магазине',
                category: 'advanced',
                icon: 'fas fa-shopping-cart',
                iconColor: '#9C27B0',
                requirement: { type: 'items_purchased', value: 100 },
                reward: { coins: 100000, multiplier: 1.7 },
                hidden: false,
                difficulty: 'legendary'
            },
            {
                id: 'max_all_upgrades',
                name: 'Совершенство улучшений',
                description: 'Максимально улучши все предметы в магазине',
                category: 'advanced',
                icon: 'fas fa-chart-line',
                iconColor: '#FF9800',
                requirement: { type: 'max_all_upgrades', value: 1 },
                reward: { coins: 200000, multiplier: 1.8 },
                hidden: false,
                difficulty: 'legendary'
            },
            {
                id: 'coins_spent_1m',
                name: 'Щедрый покупатель',
                description: 'Потрать 1,000,000 монет в магазине',
                category: 'advanced',
                icon: 'fas fa-money-bill-wave',
                iconColor: '#FFD700',
                requirement: { type: 'coins_spent', value: 1000000 },
                reward: { coins: 50000, multiplier: 1.5 },
                hidden: false,
                difficulty: 'epic'
            },
            {
                id: 'coins_spent_10m',
                name: 'Финансовый титан',
                description: 'Потрать 10,000,000 монет в магазине',
                category: 'advanced',
                icon: 'fas fa-gem',
                iconColor: '#FFD700',
                requirement: { type: 'coins_spent', value: 10000000 },
                reward: { coins: 250000, multiplier: 2.0 },
                hidden: false,
                difficulty: 'mythic'
            },
            
            // Категория: Advanced - Автокликеры
            {
                id: 'auto_clicker_10',
                name: 'Автоматическая армия',
                description: 'Приобрети 10 автокликеров',
                category: 'advanced',
                icon: 'fas fa-robot',
                iconColor: '#2196F3',
                requirement: { type: 'auto_clicker_purchased', value: 10 },
                reward: { coins: 20000, multiplier: 1.4 },
                hidden: false,
                difficulty: 'epic'
            },
            {
                id: 'auto_clicker_50',
                name: 'Роботизированная империя',
                description: 'Приобрети 50 автокликеров',
                category: 'advanced',
                icon: 'fas fa-robot',
                iconColor: '#2196F3',
                requirement: { type: 'auto_clicker_purchased', value: 50 },
                reward: { coins: 100000, multiplier: 1.8 },
                hidden: false,
                difficulty: 'legendary'
            },
            {
                id: 'auto_damage_100k',
                name: 'Машина разрушения',
                description: 'Нанеси 100,000 урона автокликерами',
                category: 'advanced',
                icon: 'fas fa-cogs',
                iconColor: '#757575',
                requirement: { type: 'auto_damage', value: 100000 },
                reward: { coins: 30000, multiplier: 1.5 },
                hidden: false,
                difficulty: 'epic'
            },
            {
                id: 'auto_damage_1m',
                name: 'Автоматический апокалипсис',
                description: 'Нанеси 1,000,000 урона автокликерами',
                category: 'advanced',
                icon: 'fas fa-industry',
                iconColor: '#757575',
                requirement: { type: 'auto_damage', value: 1000000 },
                reward: { coins: 150000, multiplier: 1.9 },
                hidden: false,
                difficulty: 'legendary'
            },
            
            // Категория: Advanced - Удача и редкость
            {
                id: 'lucky_10',
                name: 'Баловень судьбы',
                description: 'Найди 10 Lucky Blocks',
                category: 'advanced',
                icon: 'fas fa-clover',
                iconColor: '#FFEB3B',
                requirement: { type: 'lucky_blocks', value: 10 },
                reward: { coins: 50000, multiplier: 1.6 },
                hidden: false,
                difficulty: 'epic'
            },
            {
                id: 'lucky_100',
                name: 'Избранный удачи',
                description: 'Найди 100 Lucky Blocks',
                category: 'advanced',
                icon: 'fas fa-dice',
                iconColor: '#FFEB3B',
                requirement: { type: 'lucky_blocks', value: 100 },
                reward: { coins: 250000, multiplier: 2.0 },
                hidden: false,
                difficulty: 'mythic'
            },
            {
                id: 'consecutive_lucky',
                name: 'Невероятная удача',
                description: 'Найди 2 Lucky Blocks подряд',
                category: 'advanced',
                icon: 'fas fa-star-and-crescent',
                iconColor: '#FFEB3B',
                requirement: { type: 'consecutive_lucky', value: 2 },
                reward: { coins: 100000, multiplier: 1.7 },
                hidden: true,
                difficulty: 'legendary'
            },
            
            // Категория: Advanced - Секретные и очень сложные
            {
                id: 'no_regen_100',
                name: 'Безжалостный',
                description: 'Разрушь 100 блоков без регенерации',
                category: 'advanced',
                icon: 'fas fa-ban',
                iconColor: '#757575',
                requirement: { type: 'no_regen_blocks', value: 100 },
                reward: { coins: 20000, multiplier: 1.4 },
                hidden: true,
                difficulty: 'epic'
            },
            {
                id: 'one_hit_100',
                name: 'Одним ударом',
                description: 'Разрушь 100 блоков с одного удара',
                category: 'advanced',
                icon: 'fas fa-fist-raised',
                iconColor: '#F44336',
                requirement: { type: 'one_hit_blocks', value: 100 },
                reward: { coins: 50000, multiplier: 1.6 },
                hidden: true,
                difficulty: 'legendary'
            },
            {
                id: 'max_dps_1000',
                name: 'Машина смерти',
                description: 'Достигни 1000 УВС',
                category: 'advanced',
                icon: 'fas fa-tachometer-alt',
                iconColor: '#F44336',
                requirement: { type: 'max_dps', value: 1000 },
                reward: { coins: 100000, multiplier: 1.8 },
                hidden: false,
                difficulty: 'legendary'
            },
            {
                id: 'max_dps_10000',
                name: 'Бог разрушения',
                description: 'Достигни 10000 УВС',
                category: 'advanced',
                icon: 'fas fa-sun',
                iconColor: '#FF4081',
                requirement: { type: 'max_dps', value: 10000 },
                reward: { coins: 500000, multiplier: 2.5 },
                hidden: false,
                difficulty: 'mythic'
            },
            {
                id: 'all_achievements',
                name: 'Легенда Minecraft Clicker',
                description: 'Получи все достижения в игре',
                category: 'advanced',
                icon: 'fas fa-trophy',
                iconColor: '#FFD700',
                requirement: { type: 'all_achievements', value: 81 },
                reward: { coins: 1000000, multiplier: 3.0 },
                hidden: true,
                difficulty: 'mythic'
            }
        ];
        
        // ============================
        // ДАННЫЕ БЛОКОВ
        // ============================
        
        function createProgressiveBlocks(startHealth = 18, healthIncrease = 12, totalBlocks = 35) {
            const blocks = [];
            let currentHealth = startHealth;
            
            for (let i = 0; i < totalBlocks; i++) {
                blocks.push({
                    id: `block_${i + 1}`,
                    name: getBlockNameByIndex(i),
                    type: getBlockTypeByIndex(i),
                    level: 1,
                    baseHealth: currentHealth,
                    baseCoins: { 
                        min: Math.max(2, Math.floor(currentHealth / 12)), 
                        max: Math.max(5, Math.floor(currentHealth / 6)) 
                    },
                    color: getBlockColorByIndex(i),
                    innerColor: getBlockInnerColorByIndex(i),
                    borderColor: getBlockBorderColorByIndex(i),
                    borderSize: getBlockBorderSizeByIndex(i),
                    experience: Math.floor(currentHealth / 2.5),
                    isLucky: false
                });
                
                if (i < 5) {
                    currentHealth += healthIncrease;
                } else if (i < 15) {
                    currentHealth += healthIncrease * 1.5;
                } else if (i < 25) {
                    currentHealth += healthIncrease * 2;
                } else {
                    currentHealth += healthIncrease * 2.5;
                }
            }
            
            return blocks;
        }
        
        function getBlockNameByIndex(index) {
            const names = [
                "Земля", "Дерево", "Камень", "Булыжник", "Песок",
                "Уголь", "Медь", "Железо", "Олово", "Свинец",
                "Никель", "Цинк", "Серебро", "Алюминий", "Кварц",
                "Золото", "Платина", "Алмаз", "Изумруд", "Рубин",
                "Сапфир", "Топаз", "Аметист", "Опал", "Редстоун",
                "Лазурит", "Светокамень", "Призмарин", "Обсидиан", "Незерит",
                "Мифрил", "Адамантит", "Драконий камень", "Титан", "Ураниум"
            ];
            return names[index] || `Блок ${index + 1}`;
        }
        
        function getBlockTypeByIndex(index) {
            if (index < 5) return 'Базовый';
            if (index < 15) return 'Руда';
            if (index < 25) return 'Драгоценный';
            return 'Легендарный';
        }
        
        function getBlockColorByIndex(index) {
            const colors = [
                "#8B4513", "#8B4513", "#808080", "#696969", "#F4A460",
                "#2F4F4F", "#B87333", "#D1D1D1", "#C0C0C0", "#575757",
                "#A8A8A8", "#DAA520", "#C0C0C0", "#A9A9A9", "#F5F5F5",
                "#FFD700", "#E5E4E2", "#00FFFF", "#00FF00", "#FF0000",
                "#0000FF", "#FFD700", "#9932CC", "#E6E6FA", "#FF0000",
                "#0000FF", "#FFD700", "#20B2AA", "#000000", "#4A4A4A",
                "#87CEEB", "#FF4500", "#8A2BE2", "#4682B4", "#32CD32"
            ];
            return colors[index] || "#808080";
        }
        
        function getBlockInnerColorByIndex(index) {
            const colors = [
                "#A0522D", "#D49F31", "#A0A0A0", "#808080", "#DEB887",
                "#363636", "#DA8A67", "#B0B0B0", "#D3D3D3", "#696969",
                "#C0C0C0", "#F0E68C", "#E0E0E0", "#C9C9C9", "#FFFFFF",
                "#FFEC8B", "#FFFFFF", "#AFEEEE", "#98FB98", "#FF6347",
                "#4169E1", "#FFFACD", "#DA70D6", "#F0F8FF", "#FF4500",
                "#1E90FF", "#FFFF00", "#48D1CC", "#2F2F2F", "#696969",
                "#B0E0E6", "#FF6347", "#9370DB", "#87CEEB", "#90EE90"
            ];
            return colors[index] || "#A0A0A0";
        }
        
        function getBlockBorderColorByIndex(index) {
            const colors = [
                "#654321", "#733B0A", "#606060", "#505050", "#D2691E",
                "#1C1C1C", "#8B4513", "#888888", "#A9A9A9", "#404040",
                "#808080", "#B8860B", "#A0A0A0", "#898989", "#C0C0C0",
                "#B8860B", "#C0C0C0", "#008B8B", "#006400", "#8B0000",
                "#00008B", "#DAA520", "#8B008B", "#D8BFD8", "#8B0000",
                "#00008B", "#FFA500", "#008B8B", "#1A1A1A", "#2C2C2C",
                "#4682B4", "#B22222", "#4B0082", "#2F4F4F", "#228B22"
            ];
            return colors[index] || "#606060";
        }
        
        function getBlockBorderSizeByIndex(index) {
            if (index < 5) return "6px";
            if (index < 15) return "7px";
            if (index < 25) return "9px";
            return index >= 30 ? "11px" : "10px";
        }
        
        // Lucky Block
        const luckyBlockData = {
            id: 'block_lucky',
            name: 'Lucky Block',
            type: 'Легендарный',
            level: 1,
            baseHealth: 1,
            maxHealth: 1,
            baseCoins: { min: 5000, max: 5000 },
            color: '#FFEB3B',
            innerColor: '#FFF59D',
            borderColor: '#FBC02D',
            borderSize: "10px",
            experience: 100,
            isLucky: true
        };
        
        // Массив активных блоков
        let blocks = [];
        let currentStage = 1;
        let healthMultiplier = 1.0;
        let isLuckyBlockActive = false;
        let consecutiveLuckyBlocks = 0;
        let lastBlockWasLucky = false;
        
        // ============================
        // МАГАЗИН (УЛУЧШЕННЫЙ)
        // ============================
        
        const shopItems = [
            // АВТОКЛИКЕРЫ (7 УРОВНЕЙ)
            {
                id: 'auto_clicker_1',
                name: 'Базовый автокликер',
                category: 'clickers',
                basePrice: 5000,
                priceMultiplier: 1.8,
                maxLevel: 7,
                description: 'Автоматически кликает по блоку.',
                icon: 'fas fa-mouse-pointer',
                iconColor: '#4CAF50',
                effect: { type: 'autoClicker', baseDamage: 1, baseInterval: 10000 },
                getDescription: function(level) {
                    const intervals = [10000, 9000, 8000, 7000, 6000, 5000, 4000];
                    const damages = [1, 2, 3, 4, 5, 6, 7];
                    return `Наносит ${damages[level-1]} урон каждые ${intervals[level-1]/1000} сек`;
                },
                getStats: function(level) {
                    return {
                        damage: [1, 2, 3, 4, 5, 6, 7][level-1] || 1,
                        interval: [10000, 9000, 8000, 7000, 6000, 5000, 4000][level-1] || 10000
                    };
                }
            },
            {
                id: 'auto_clicker_2',
                name: 'Улучшенный автокликер',
                category: 'clickers',
                basePrice: 15000,
                priceMultiplier: 2.0,
                maxLevel: 7,
                description: 'Быстрый автокликер с улучшенным уроном.',
                icon: 'fas fa-bolt',
                iconColor: '#FF9800',
                effect: { type: 'autoClicker', baseDamage: 2, baseInterval: 8000 },
                getDescription: function(level) {
                    const intervals = [8000, 7200, 6400, 5600, 4800, 4000, 3200];
                    const damages = [2, 3, 4, 5, 6, 7, 8];
                    return `Наносит ${damages[level-1]} урон каждые ${intervals[level-1]/1000} сек`;
                },
                requires: 'auto_clicker_1',
                getStats: function(level) {
                    return {
                        damage: [2, 3, 4, 5, 6, 7, 8][level-1] || 2,
                        interval: [8000, 7200, 6400, 5600, 4800, 4000, 3200][level-1] || 8000
                    };
                }
            },
            {
                id: 'auto_clicker_3',
                name: 'Продвинутый автокликер',
                category: 'clickers',
                basePrice: 45000,
                priceMultiplier: 2.2,
                maxLevel: 7,
                description: 'Мощный автокликер для опытных игроков.',
                icon: 'fas fa-rocket',
                iconColor: '#F44336',
                effect: { type: 'autoClicker', baseDamage: 3, baseInterval: 6000 },
                getDescription: function(level) {
                    const intervals = [6000, 5400, 4800, 4200, 3600, 3000, 2400];
                    const damages = [3, 5, 7, 9, 11, 13, 15];
                    return `Наносит ${damages[level-1]} урон каждые ${intervals[level-1]/1000} сек`;
                },
                requires: 'auto_clicker_2',
                getStats: function(level) {
                    return {
                        damage: [3, 5, 7, 9, 11, 13, 15][level-1] || 3,
                        interval: [6000, 5400, 4800, 4200, 3600, 3000, 2400][level-1] || 6000
                    };
                }
            },
            {
                id: 'auto_clicker_4',
                name: 'Эпический автокликер',
                category: 'clickers',
                basePrice: 125000,
                priceMultiplier: 2.4,
                maxLevel: 7,
                description: 'Эпический автокликер с огромным уроном.',
                icon: 'fas fa-robot',
                iconColor: '#9C27B0',
                effect: { type: 'autoClicker', baseDamage: 5, baseInterval: 5000 },
                getDescription: function(level) {
                    const intervals = [5000, 4500, 4000, 3500, 3000, 2500, 2000];
                    const damages = [5, 8, 11, 14, 17, 20, 25];
                    return `Наносит ${damages[level-1]} урон каждые ${intervals[level-1]/1000} сек`;
                },
                requires: 'auto_clicker_3',
                getStats: function(level) {
                    return {
                        damage: [5, 8, 11, 14, 17, 20, 25][level-1] || 5,
                        interval: [5000, 4500, 4000, 3500, 3000, 2500, 2000][level-1] || 5000
                    };
                }
            },
            
            // СИЛА УДАРА (7 УРОВНЕЙ)
            {
                id: 'damage_booster',
                name: 'Сила удара',
                category: 'boosters',
                basePrice: 3000,
                priceMultiplier: 2.0,
                maxLevel: 7,
                description: 'Увеличивает ваш урон от кликов.',
                icon: 'fas fa-fist-raised',
                iconColor: '#FF4444',
                effect: { type: 'damageMultiplier', values: [1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 5.0] },
                getDescription: function(level) {
                    const bonuses = ['+50%', '+100%', '+150%', '+200%', '+250%', '+300%', '+400%'];
                    return `Увеличивает урон на ${bonuses[level-1]}`;
                },
                getStats: function(level) {
                    return {
                        multiplier: [1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 5.0][level-1] || 1.5
                    };
                }
            },
            
            // УДАЧА (7 УРОВНЕЙ)
            {
                id: 'luck_booster',
                name: 'Удача',
                category: 'boosters',
                basePrice: 5000,
                priceMultiplier: 2.0,
                maxLevel: 7,
                description: 'Увеличивает количество получаемых монет.',
                icon: 'fas fa-clover',
                iconColor: '#4CAF50',
                effect: { type: 'luckMultiplier', values: [1.25, 1.5, 1.75, 2.0, 2.25, 2.5, 3.0] },
                getDescription: function(level) {
                    const bonuses = ['+25%', '+50%', '+75%', '+100%', '+125%', '+150%', '+200%'];
                    return `Увеличивает монеты на ${bonuses[level-1]}`;
                },
                getStats: function(level) {
                    return {
                        multiplier: [1.25, 1.5, 1.75, 2.0, 2.25, 2.5, 3.0][level-1] || 1.25
                    };
                }
            },
            
            // МНОЖИТЕЛЬ МОНЕТ (7 УРОВНЕЙ)
            {
                id: 'coin_booster',
                name: 'Множитель монет',
                category: 'boosters',
                basePrice: 4000,
                priceMultiplier: 2.0,
                maxLevel: 7,
                description: 'Увеличивает количество получаемых монет.',
                icon: 'fas fa-coins',
                iconColor: '#FFD700',
                effect: { type: 'coinMultiplier', values: [1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 5.0] },
                getDescription: function(level) {
                    const bonuses = ['+50%', '+100%', '+150%', '+200%', '+250%', '+300%', '+400%'];
                    return `Увеличивает монеты на ${bonuses[level-1]}`;
                },
                getStats: function(level) {
                    return {
                        multiplier: [1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 5.0][level-1] || 1.5
                    };
                }
            },
            
            // Особые предметы
            {
                id: 'critical_boost',
                name: 'Критический удар',
                category: 'boosters',
                basePrice: 10000,
                priceMultiplier: 1.5,
                maxLevel: 3,
                description: 'Увеличивает шанс критического удара.',
                icon: 'fas fa-bullseye',
                iconColor: '#F44336',
                effect: { type: 'critical', baseChance: 10, baseMultiplier: 2 },
                getDescription: function(level) {
                    const chances = ['10%', '15%', '20%'];
                    const multipliers = ['x2', 'x2.5', 'x3'];
                    return `${chances[level-1]} шанс критического удара (${multipliers[level-1]})`;
                },
                getStats: function(level) {
                    return {
                        chance: [10, 15, 20][level-1] || 10,
                        multiplier: [2.0, 2.5, 3.0][level-1] || 2.0
                    };
                }
            },
            {
                id: 'anti_regen',
                name: 'Анти-регенерация',
                category: 'boosters',
                price: 20000,
                description: 'Отключает регенерацию блоков.',
                icon: 'fas fa-ban',
                iconColor: '#757575',
                effect: { type: 'antiRegen' },
                maxLevel: 1
            },
            
            // Дополнительные предметы
            {
                id: 'double_coins',
                name: 'Удвоение монет',
                category: 'additional',
                price: 15000,
                description: 'На 60 секунд все монеты удваиваются.',
                icon: 'fas fa-coins',
                iconColor: '#FFD700',
                effect: { type: 'doubleCoins', duration: 60000 },
                maxLevel: 1,
                consumable: true
            },
            {
                id: 'damage_boost',
                name: 'Буст урона',
                category: 'additional',
                price: 20000,
                description: 'На 60 секунд урон увеличивается в 3 раза.',
                icon: 'fas fa-bolt',
                iconColor: '#FF4444',
                effect: { type: 'damageBoost', multiplier: 3, duration: 60000 },
                maxLevel: 1,
                consumable: true
            },
            {
                id: 'luck_boost',
                name: 'Буст удачи',
                category: 'additional',
                price: 25000,
                description: 'На 60 секунд удача увеличивается в 2 раза.',
                icon: 'fas fa-clover',
                iconColor: '#4CAF50',
                effect: { type: 'luckBoost', multiplier: 2, duration: 60000 },
                maxLevel: 1,
                consumable: true
            },
            
            // Премиум предметы
            {
                id: 'auto_clicker_master',
                name: 'Мастер автокликеров',
                category: 'premium',
                price: 100000,
                description: 'Увеличивает урон всех автокликеров на 50%.',
                icon: 'fas fa-crown',
                iconColor: '#FFD700',
                effect: { type: 'autoClickerMaster' },
                maxLevel: 1
            },
            {
                id: 'lucky_charm',
                name: 'Счастливый талисман',
                category: 'premium',
                price: 75000,
                description: 'Увеличивает шанс появления Lucky Block в 2 раза.',
                icon: 'fas fa-star',
                iconColor: '#FFEB3B',
                effect: { type: 'luckyCharm' },
                maxLevel: 1
            },
            {
                id: 'unbreakable_pickaxe',
                name: 'Незеритовая кирка',
                category: 'premium',
                price: 150000,
                description: 'Каждый удар наносит двойной урон блокам.',
                icon: 'fas fa-gem',
                iconColor: '#4A4A4A',
                effect: { type: 'unbreakablePickaxe' },
                maxLevel: 1
            }
        ];
        
        // ============================
        // ИНИЦИАЛИЗАЦИЯ ИГРЫ
        // ============================
        
        let gameState = {
            // Основные
            coins: 0,
            currentBlock: 0,
            currentHealth: 0,
            maxHealth: 0,
            currentStage: 1,
            maxHealthMultiplier: 1.0,
            highestStage: 1,
            
            // Статистика
            totalClicks: 0,
            blocksBroken: 0,
            totalCoinsEarned: 0,
            totalDamage: 0,
            playTimeSeconds: 0,
            startTime: Date.now(),
            lastSaveTime: Date.now(),
            
            // Достижения
            achievements: {},
            achievementsUnlocked: 0,
            
            // Расширенная статистика для новых достижений
            luckyBlocksFound: 0,
            sessionCoins: 0,
            sessionStartTime: Date.now(),
            specificBlocksBroken: {},
            totalItemsPurchased: 0,
            totalCoinsSpent: 0,
            criticalHits: 0,
            maxCombo: 0,
            currentCombo: 0,
            lastClickTime: 0,
            fastBlockBreaks: 0,
            autoClickersPurchased: 0,
            maxUpgrades: 0,
            blocksDestroyed: Array(35).fill(0),
            perfectHits: 0,
            autoDamage: 0,
            noRegenBlocks: 0,
            oneHitBlocks: 0,
            maxDPS: 0,
            consecutiveLuckyBlocks: 0,
            maxConsecutiveLucky: 0,
            
            // Улучшения
            damageMultiplier: 1,
            coinMultiplier: 1,
            luckMultiplier: 1,
            criticalChance: 5,
            criticalMultiplier: 2,
            autoClickerDamageBonus: 0,
            luckyBlockChance: 0.002,
            
            // Автокликеры
            autoClickers: [],
            autoClickerDamage: 0,
            
            // Регенерация
            regenerationEnabled: true,
            regenerationRate: 10,
            regenerationDelay: 30000, // 30 секунд
            antiRegen: false,
            
            // Временные бусты
            doubleCoinsActive: false,
            doubleCoinsEnd: 0,
            damageBoostActive: false,
            damageBoostEnd: 0,
            luckBoostActive: false,
            luckBoostEnd: 0,
            
            // Настройки
            soundEnabled: true,
            notificationsEnabled: true,
            autosaveEnabled: true,
            animationsEnabled: true,
            
            // Купленные предметы
            purchasedItems: {},
            
            // Системные
            isBreaking: false,
            isTouching: false,
            lastHitTime: Date.now(),
            regenerationTimer: null,
            regenerationInterval: null,
            autoClickerIntervals: [],
            playTimer: null,
            saveInterval: null,
            
            // Для титров
            creditsShown: false
        };
        
        // Элементы DOM
        const continueBtn = document.getElementById('continue-btn');
        const newGameBtn = document.getElementById('new-game-btn');
        const statsMenuBtn = document.getElementById('stats-menu-btn');
        const shopMenuBtn = document.getElementById('shop-menu-btn');
        const achievementsMenuBtn = document.getElementById('achievements-menu-btn');
        const settingsMenuBtn = document.getElementById('settings-menu-btn');
        const privacyBtn = document.getElementById('privacy-btn');
        const gameShopBtn = document.getElementById('game-shop-btn');
        const gameStatsBtn = document.getElementById('game-stats-btn');
        const gameMenuBtn = document.getElementById('game-menu-btn');
        const creditsBackBtn = document.getElementById('credits-back-btn');
        
        const block = document.getElementById('block');
        const blockImg = document.getElementById('block-img');
        const cracksOverlay = document.getElementById('cracks-overlay');
        const coinsCounter = document.getElementById('coins-counter');
        const stageCounter = document.getElementById('stage-counter');
        const blockName = document.getElementById('block-name');
        const blockType = document.getElementById('block-type');
        const healthDisplay = document.getElementById('health-display');
        const progressBar = document.getElementById('progress-bar');
        const regenerationIndicator = document.getElementById('regeneration-indicator');
        const autoClickerInfo = document.getElementById('auto-clicker-info');
        
        // ============================
        // ФУНКЦИИ ДОСТИЖЕНИЙ (УЛУЧШЕННЫЕ)
        // ============================
        
        function checkAchievements() {
            let achievementsCount = 0;
            
            achievementsData.forEach(achievement => {
                let progress = 0;
                let maxProgress = achievement.requirement.value;
                let progressPercent = 0;
                
                // Вычисляем текущий прогресс
                switch (achievement.requirement.type) {
                    case 'blocks_broken':
                        progress = gameState.blocksBroken;
                        break;
                        
                    case 'lucky_blocks':
                        progress = gameState.luckyBlocksFound;
                        break;
                        
                    case 'fast_block_break':
                        progress = gameState.fastBlockBreaks;
                        break;
                        
                    case 'total_coins':
                        progress = gameState.totalCoinsEarned;
                        break;
                        
                    case 'total_clicks':
                        progress = gameState.totalClicks;
                        break;
                        
                    case 'total_damage':
                        progress = gameState.totalDamage;
                        break;
                        
                    case 'critical_hits':
                        progress = gameState.criticalHits;
                        break;
                        
                    case 'items_purchased':
                        progress = gameState.totalItemsPurchased;
                        break;
                        
                    case 'auto_clicker_purchased':
                        progress = gameState.autoClickersPurchased;
                        break;
                        
                    case 'max_upgrade':
                        progress = gameState.maxUpgrades;
                        break;
                        
                    case 'play_time':
                        const totalPlayTime = gameState.playTimeSeconds + Math.floor((Date.now() - gameState.startTime) / 1000);
                        progress = totalPlayTime;
                        break;
                        
                    case 'stage_reached':
                        progress = gameState.highestStage;
                        break;
                        
                    case 'combo':
                        progress = gameState.maxCombo;
                        break;
                        
                    case 'perfect_hit':
                        progress = gameState.perfectHits;
                        break;
                        
                    case 'all_blocks':
                        const uniqueBlocks = gameState.blocksDestroyed.filter(count => count > 0).length;
                        progress = uniqueBlocks;
                        maxProgress = Math.min(maxProgress, 35);
                        break;
                        
                    case 'blocks_10k_each':
                        const all10k = gameState.blocksDestroyed.every(count => count >= 10000);
                        progress = gameState.blocksDestroyed.filter(count => count >= 10000).length;
                        maxProgress = 35;
                        break;
                        
                    case 'coins_spent':
                        progress = gameState.totalCoinsSpent;
                        break;
                        
                    case 'max_all_upgrades':
                        const allMaxed = shopItems.every(item => {
                            if (item.maxLevel <= 1) return true;
                            const purchased = gameState.purchasedItems[item.id];
                            return purchased && purchased.level >= item.maxLevel;
                        });
                        progress = shopItems.filter(item => {
                            if (item.maxLevel <= 1) return true;
                            const purchased = gameState.purchasedItems[item.id];
                            return purchased && purchased.level >= item.maxLevel;
                        }).length;
                        maxProgress = shopItems.filter(item => item.maxLevel > 1).length;
                        break;
                        
                    case 'auto_damage':
                        progress = gameState.autoDamage;
                        break;
                        
                    case 'consecutive_lucky':
                        progress = gameState.maxConsecutiveLucky;
                        break;
                        
                    case 'no_regen_blocks':
                        progress = gameState.noRegenBlocks;
                        break;
                        
                    case 'one_hit_blocks':
                        progress = gameState.oneHitBlocks;
                        break;
                        
                    case 'max_dps':
                        const currentDPS = calculateDPS();
                        if (currentDPS > gameState.maxDPS) {
                            gameState.maxDPS = currentDPS;
                        }
                        progress = gameState.maxDPS;
                        break;
                        
                    case 'all_achievements':
                        progress = gameState.achievementsUnlocked;
                        maxProgress = 81;
                        break;
                }
                
                // Вычисляем процент прогресса
                progressPercent = Math.min(100, (progress / maxProgress) * 100);
                
                // Проверяем, разблокировано ли достижение
                const isUnlocked = progress >= maxProgress;
                
                // Если достижение еще не существует в состоянии игры
                if (!gameState.achievements[achievement.id]) {
                    gameState.achievements[achievement.id] = {
                        unlocked: isUnlocked,
                        progress: progress,
                        maxProgress: maxProgress,
                        progressPercent: progressPercent
                    };
                    
                    if (isUnlocked) {
                        gameState.achievements[achievement.id].unlockedAt = Date.now();
                        gameState.achievementsUnlocked++;
                        unlockAchievement(achievement, progress, maxProgress);
                    }
                } else {
                    // Обновляем прогресс
                    gameState.achievements[achievement.id].progress = progress;
                    gameState.achievements[achievement.id].maxProgress = maxProgress;
                    gameState.achievements[achievement.id].progressPercent = progressPercent;
                    
                    // Если достижение было разблокировано только что
                    if (!gameState.achievements[achievement.id].unlocked && isUnlocked) {
                        gameState.achievements[achievement.id].unlocked = true;
                        gameState.achievements[achievement.id].unlockedAt = Date.now();
                        gameState.achievementsUnlocked++;
                        unlockAchievement(achievement, progress, maxProgress);
                    }
                }
                
                if (gameState.achievements[achievement.id]?.unlocked) {
                    achievementsCount++;
                }
            });
            
            // Обновляем счетчик достижений
            updateAchievementsCounter(achievementsCount);
        }
        
        function updateAchievementsCounter(count) {
            const achievementsCountElement = document.getElementById('achievements-count');
            const totalAchievementsElement = document.getElementById('total-achievements');
            
            if (achievementsCountElement) {
                achievementsCountElement.textContent = `${count}/81`;
            }
            
            if (totalAchievementsElement) {
                totalAchievementsElement.textContent = `(${count}/81)`;
            }
        }
        
        function unlockAchievement(achievement, progress, maxProgress) {
            console.log(`Разблокировано достижение: ${achievement.name} (${achievement.difficulty || 'обычное'})`);
            
            if (achievement.reward.coins) {
                gameState.coins += achievement.reward.coins;
                gameState.totalCoinsEarned += achievement.reward.coins;
                console.log(`Награда: +${achievement.reward.coins} монет`);
            }
            
            if (achievement.reward.multiplier && achievement.reward.multiplier > 1) {
                gameState.coinMultiplier *= achievement.reward.multiplier;
                console.log(`Награда: множитель x${achievement.reward.multiplier}`);
            }
            
            if (gameState.notificationsEnabled) {
                if (achievement.difficulty === 'epic' || achievement.difficulty === 'legendary' || achievement.difficulty === 'mythic') {
                    showEpicAchievementNotification(achievement);
                } else {
                    showAchievementNotification(achievement);
                }
            }
            
            updateUI();
            saveGame();
        }
        
        function showAchievementNotification(achievement) {
            achievementNotification.innerHTML = `
                <i class="fas fa-trophy"></i> Новое достижение: ${achievement.name}
            `;
            achievementNotification.style.display = 'block';
            
            setTimeout(() => {
                achievementNotification.style.display = 'none';
            }, 3000);
        }
        
        function showEpicAchievementNotification(achievement) {
            let color = '#FF9800';
            let icon = 'fas fa-crown';
            
            if (achievement.difficulty === 'epic') {
                color = '#9C27B0';
                icon = 'fas fa-gem';
            } else if (achievement.difficulty === 'legendary') {
                color = '#FF9800';
                icon = 'fas fa-crown';
            } else if (achievement.difficulty === 'mythic') {
                color = '#FF4081';
                icon = 'fas fa-fire';
            }
            
            epicAchievementNotification.innerHTML = `
                <i class="${icon}"></i> ${achievement.difficulty === 'epic' ? 'Эпическое' : achievement.difficulty === 'legendary' ? 'Легендарное' : 'Мифическое'} достижение: ${achievement.name}
            `;
            epicAchievementNotification.style.background = `linear-gradient(45deg, ${color}, ${color === '#9C27B0' ? '#7B1FA2' : color === '#FF9800' ? '#F57C00' : '#C2185B'})`;
            epicAchievementNotification.style.display = 'block';
            
            setTimeout(() => {
                epicAchievementNotification.style.display = 'none';
            }, 4000);
        }
        
        function loadAchievements() {
            const achievementsContainer = document.getElementById('achievements-container');
            achievementsContainer.innerHTML = '';
            
            const activeCategory = document.querySelector('.achievement-categories .category-btn.active').dataset.category;
            const filteredAchievements = achievementsData.filter(achievement => {
                if (activeCategory === 'all') return true;
                if (activeCategory === 'advanced') return achievement.category === 'advanced';
                return achievement.category === activeCategory;
            });
            
            filteredAchievements.forEach((achievement, index) => {
                const achievementState = gameState.achievements[achievement.id] || {
                    unlocked: false,
                    progress: 0,
                    maxProgress: achievement.requirement.value || 1,
                    progressPercent: 0
                };
                
                let difficultyClass = '';
                if (achievement.difficulty === 'epic') {
                    difficultyClass = 'achievement-epic';
                } else if (achievement.difficulty === 'legendary') {
                    difficultyClass = 'achievement-legendary';
                } else if (achievement.difficulty === 'mythic') {
                    difficultyClass = 'achievement-mythic';
                }
                
                const achievementElement = document.createElement('div');
                achievementElement.className = `achievement-item ${achievementState.unlocked ? 'unlocked' : ''} ${difficultyClass} ${achievement.hidden && !achievementState.unlocked ? 'achievement-hidden' : ''}`;
                achievementElement.style.animationDelay = `${index * 0.05}s`;
                
                // Обновляем прогресс перед отображением
                checkAchievementProgress(achievement, achievementState);
                
                let progressBarHTML = '';
                if (!achievementState.unlocked && achievementState.progressPercent < 100) {
                    progressBarHTML = `
                        <div class="achievement-progress">
                            <div class="progress-text">
                                <span>Прогресс</span>
                                <span>${formatNumber(Math.floor(achievementState.progress))}/${formatNumber(achievementState.maxProgress)}</span>
                            </div>
                            <div class="progress-bar-small">
                                <div class="progress-bar-fill" style="width: ${achievementState.progressPercent}%"></div>
                            </div>
                        </div>
                    `;
                }
                
                let rewardHTML = '';
                if (achievement.reward.coins || achievement.reward.multiplier) {
                    let rewardText = '';
                    if (achievement.reward.coins) {
                        rewardText += `+${formatNumber(achievement.reward.coins)} монет`;
                    }
                    if (achievement.reward.multiplier && achievement.reward.multiplier > 1) {
                        if (rewardText) rewardText += ', ';
                        rewardText += `множитель x${achievement.reward.multiplier}`;
                    }
                    
                    rewardHTML = `<div class="achievement-reward"><i class="fas fa-gift"></i> Награда: ${rewardText}</div>`;
                }
                
                let difficultyBadge = '';
                if (achievement.difficulty) {
                    let badgeColor = '#4CAF50';
                    let badgeText = 'Обычное';
                    
                    if (achievement.difficulty === 'epic') {
                        badgeColor = '#9C27B0';
                        badgeText = 'Эпическое';
                    } else if (achievement.difficulty === 'legendary') {
                        badgeColor = '#FF9800';
                        badgeText = 'Легендарное';
                    } else if (achievement.difficulty === 'mythic') {
                        badgeColor = '#FF4081';
                        badgeText = 'Мифическое';
                    }
                    
                    difficultyBadge = `<span style="background-color: ${badgeColor}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; margin-left: 5px;">${badgeText}</span>`;
                }
                
                achievementElement.innerHTML = `
                    <div class="achievement-header">
                        <div class="achievement-title">
                            <div class="achievement-icon" style="background-color: ${achievement.iconColor};">
                                <i class="${achievement.icon}"></i>
                            </div>
                            ${achievement.name} ${difficultyBadge}
                        </div>
                        ${achievementState.unlocked ? 
                            '<div class="achievement-unlocked-badge"><i class="fas fa-check"></i> Разблокировано</div>' : 
                            ''}
                    </div>
                    <div class="achievement-description">${achievement.description}</div>
                    ${progressBarHTML}
                    ${rewardHTML}
                `;
                
                achievementsContainer.appendChild(achievementElement);
            });
        }
        
        function checkAchievementProgress(achievement, achievementState) {
            // Пересчитываем прогресс для отображения
            let progress = 0;
            let maxProgress = achievement.requirement.value;
            
            switch (achievement.requirement.type) {
                case 'blocks_broken':
                    progress = gameState.blocksBroken;
                    break;
                case 'lucky_blocks':
                    progress = gameState.luckyBlocksFound;
                    break;
                case 'total_coins':
                    progress = gameState.totalCoinsEarned;
                    break;
                case 'total_clicks':
                    progress = gameState.totalClicks;
                    break;
                case 'total_damage':
                    progress = gameState.totalDamage;
                    break;
                case 'critical_hits':
                    progress = gameState.criticalHits;
                    break;
                case 'items_purchased':
                    progress = gameState.totalItemsPurchased;
                    break;
                case 'auto_clicker_purchased':
                    progress = gameState.autoClickersPurchased;
                    break;
                case 'play_time':
                    const totalPlayTime = gameState.playTimeSeconds + Math.floor((Date.now() - gameState.startTime) / 1000);
                    progress = totalPlayTime;
                    break;
                case 'stage_reached':
                    progress = gameState.highestStage;
                    break;
                case 'combo':
                    progress = gameState.maxCombo;
                    break;
                case 'perfect_hit':
                    progress = gameState.perfectHits;
                    break;
                case 'all_blocks':
                    progress = gameState.blocksDestroyed.filter(count => count > 0).length;
                    maxProgress = Math.min(maxProgress, 35);
                    break;
                default:
                    progress = achievementState.progress;
            }
            
            achievementState.progress = progress;
            achievementState.maxProgress = maxProgress;
            achievementState.progressPercent = Math.min(100, (progress / maxProgress) * 100);
        }
        
        // ============================
        // ФУНКЦИИ СОХРАНЕНИЯ
        // ============================
        
        function saveGame() {
            if (!gameState.autosaveEnabled) return;
            
            const saveData = {
                version: SAVE_VERSION,
                timestamp: Date.now(),
                gameState: {
                    coins: gameState.coins,
                    currentBlock: gameState.currentBlock,
                    currentHealth: gameState.currentHealth,
                    maxHealth: gameState.maxHealth,
                    currentStage: currentStage,
                    maxHealthMultiplier: healthMultiplier,
                    highestStage: gameState.highestStage,
                    
                    totalClicks: gameState.totalClicks,
                    blocksBroken: gameState.blocksBroken,
                    totalCoinsEarned: gameState.totalCoinsEarned,
                    totalDamage: gameState.totalDamage,
                    playTimeSeconds: gameState.playTimeSeconds,
                    startTime: gameState.startTime,
                    
                    achievements: gameState.achievements,
                    achievementsUnlocked: gameState.achievementsUnlocked,
                    
                    luckyBlocksFound: gameState.luckyBlocksFound,
                    sessionCoins: gameState.sessionCoins,
                    sessionStartTime: gameState.sessionStartTime,
                    specificBlocksBroken: gameState.specificBlocksBroken,
                    totalItemsPurchased: gameState.totalItemsPurchased,
                    totalCoinsSpent: gameState.totalCoinsSpent,
                    criticalHits: gameState.criticalHits,
                    maxCombo: gameState.maxCombo,
                    fastBlockBreaks: gameState.fastBlockBreaks,
                    autoClickersPurchased: gameState.autoClickersPurchased,
                    maxUpgrades: gameState.maxUpgrades,
                    blocksDestroyed: gameState.blocksDestroyed,
                    perfectHits: gameState.perfectHits,
                    autoDamage: gameState.autoDamage,
                    noRegenBlocks: gameState.noRegenBlocks,
                    oneHitBlocks: gameState.oneHitBlocks,
                    maxDPS: gameState.maxDPS,
                    consecutiveLuckyBlocks: gameState.consecutiveLuckyBlocks,
                    maxConsecutiveLucky: gameState.maxConsecutiveLucky,
                    
                    damageMultiplier: gameState.damageMultiplier,
                    coinMultiplier: gameState.coinMultiplier,
                    luckMultiplier: gameState.luckMultiplier,
                    criticalChance: gameState.criticalChance,
                    criticalMultiplier: gameState.criticalMultiplier,
                    autoClickerDamageBonus: gameState.autoClickerDamageBonus,
                    luckyBlockChance: gameState.luckyBlockChance,
                    
                    autoClickers: gameState.autoClickers,
                    autoClickerDamage: gameState.autoClickerDamage,
                    
                    regenerationEnabled: gameState.regenerationEnabled,
                    regenerationRate: gameState.regenerationRate,
                    regenerationDelay: gameState.regenerationDelay,
                    antiRegen: gameState.antiRegen,
                    
                    doubleCoinsActive: gameState.doubleCoinsActive,
                    doubleCoinsEnd: gameState.doubleCoinsEnd,
                    damageBoostActive: gameState.damageBoostActive,
                    damageBoostEnd: gameState.damageBoostEnd,
                    luckBoostActive: gameState.luckBoostActive,
                    luckBoostEnd: gameState.luckBoostEnd,
                    
                    soundEnabled: gameState.soundEnabled,
                    notificationsEnabled: gameState.notificationsEnabled,
                    autosaveEnabled: gameState.autosaveEnabled,
                    animationsEnabled: gameState.animationsEnabled,
                    
                    purchasedItems: gameState.purchasedItems,
                    
                    creditsShown: gameState.creditsShown
                }
            };
            
            try {
                localStorage.setItem('minecraftClickerSave', JSON.stringify(saveData));
                gameState.lastSaveTime = Date.now();
                
                if (gameState.notificationsEnabled) {
                    showSaveNotification();
                }
            } catch (e) {
                console.error('Ошибка при сохранении игры:', e);
            }
        }
        
        function loadGame() {
            try {
                const saveData = localStorage.getItem('minecraftClickerSave');
                
                if (!saveData) {
                    return false;
                }
                
                const parsedData = JSON.parse(saveData);
                
                // Миграция старых сохранений
                if (!parsedData.version || parsedData.version !== SAVE_VERSION) {
                    // Можно добавить миграцию данных здесь
                    return false;
                }
                
                const loadedState = parsedData.gameState;
                
                // Загружаем все основные поля
                Object.keys(loadedState).forEach(key => {
                    if (gameState[key] !== undefined) {
                        gameState[key] = loadedState[key];
                    }
                });
                
                // Загружаем отдельные поля, которые могут отсутствовать в старых сохранениях
                currentStage = loadedState.currentStage || 1;
                healthMultiplier = loadedState.maxHealthMultiplier || 1.0;
                
                // Инициализируем блоки с правильной стадией
                initializeBlocks(currentStage);
                
                return true;
            } catch (e) {
                console.error('Ошибка при загрузке игры:', e);
                return false;
            }
        }
        
        function clearSave() {
            try {
                localStorage.removeItem('minecraftClickerSave');
                return true;
            } catch (e) {
                console.error('Ошибка при очистке сохранения:', e);
                return false;
            }
        }
        
        function showSaveNotification() {
            const saveNotification = document.getElementById('save-notification');
            saveNotification.style.display = 'block';
            setTimeout(() => {
                saveNotification.style.display = 'none';
            }, 2000);
        }
        
        // ============================
        // ИНИЦИАЛИЗАЦИЯ ИГРЫ
        // ============================
        
        function initGame() {
            const loaded = loadGame();
            
            if (loaded && gameState.currentBlock !== undefined) {
                continueBtn.style.display = 'flex';
            } else {
                continueBtn.style.display = 'none';
                gameState.currentBlock = 0;
                currentStage = 1;
                healthMultiplier = 1.0;
                initializeBlocks(1);
            }
            
            initCurrentBlock();
            updateUI();
            loadShopItems();
            loadStats();
            loadAchievements();
            setupControls();
            startTimers();
            
            checkAchievements();
            
            setTimeout(() => {
                loadingScreen.style.display = 'none';
                menuScreen.style.display = 'flex';
            }, 500);
        }
        
        function initializeBlocks(stage = 1) {
            const baseHealth = 18 + (stage - 1) * 6;
            const healthIncrease = 12 + (stage - 1) * 3;
            
            blocks = createProgressiveBlocks(baseHealth, healthIncrease);
            healthMultiplier = 1 + (stage - 1) * 0.25;
            
            blocks.forEach(block => {
                block.maxHealth = Math.floor(block.baseHealth * healthMultiplier);
            });
            
            currentStage = stage;
            gameState.currentStage = stage;
            gameState.maxHealthMultiplier = healthMultiplier;
        }
        
        function initCurrentBlock() {
            if (blocks.length === 0) {
                initializeBlocks(currentStage);
            }
            
            // Проверяем шанс Lucky Block с учетом улучшений
            let luckyChance = gameState.luckyBlockChance;
            if (gameState.purchasedItems['lucky_charm']) {
                luckyChance *= 2;
            }
            
            const isLuckyBlock = Math.random() < luckyChance && !isLuckyBlockActive;
            
            if (isLuckyBlock) {
                isLuckyBlockActive = true;
                createLuckyBlock();
            } else {
                if (gameState.currentBlock >= blocks.length) {
                    gameState.currentBlock = 0;
                }
                
                const blockData = blocks[gameState.currentBlock];
                
                if (!blockData) {
                    gameState.currentBlock = 0;
                    return initCurrentBlock();
                }
                
                gameState.maxHealth = blockData.maxHealth;
                
                if (gameState.currentHealth <= 0 || gameState.currentHealth > gameState.maxHealth) {
                    gameState.currentHealth = gameState.maxHealth;
                }
                
                createBlockSVG(blockData);
                blockName.textContent = blockData.name;
                blockType.textContent = blockData.type;
                block.classList.remove('lucky');
                
                if (currentStage > 1) {
                    blockName.textContent = `${blockData.name} (Стадия ${currentStage})`;
                }
            }
        }
        
        function createLuckyBlock() {
            gameState.maxHealth = luckyBlockData.maxHealth;
            gameState.currentHealth = luckyBlockData.maxHealth;
            
            createBlockSVG(luckyBlockData);
            blockName.textContent = luckyBlockData.name;
            blockType.textContent = luckyBlockData.type;
            block.classList.add('lucky');
            
            if (gameState.notificationsEnabled) {
                luckyNotification.style.display = 'block';
                setTimeout(() => {
                    luckyNotification.style.display = 'none';
                }, 3000);
            }
        }
        
        function createBlockSVG(blockData) {
            const svgCode = `
                <svg width="240" height="240" viewBox="0 0 240 240" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <filter id="blockShadow">
                            <feDropShadow dx="0" dy="4" stdDeviation="4" flood-opacity="0.5"/>
                        </filter>
                        <pattern id="blockPattern" patternUnits="userSpaceOnUse" width="20" height="20">
                            <rect width="20" height="20" fill="${blockData.color}" opacity="0.3"/>
                            <rect x="10" y="0" width="10" height="10" fill="${blockData.innerColor}" opacity="0.2"/>
                            <rect x="0" y="10" width="10" height="10" fill="${blockData.innerColor}" opacity="0.2"/>
                        </pattern>
                    </defs>
                    <rect width="240" height="240" fill="${blockData.color}" filter="url(#blockShadow)" rx="5"/>
                    <rect x="20" y="20" width="200" height="200" fill="${blockData.innerColor}" rx="3"/>
                    <rect x="10" y="10" width="220" height="220" fill="url(#blockPattern)" opacity="0.4" rx="5"/>
                    <rect width="240" height="240" fill="none" stroke="${blockData.borderColor}" stroke-width="${blockData.borderSize}" rx="5"/>
                </svg>
            `;
            
            const svgBlob = new Blob([svgCode], {type: 'image/svg+xml'});
            const svgUrl = URL.createObjectURL(svgBlob);
            blockImg.src = svgUrl;
            blockImg.style.borderColor = blockData.borderColor;
            
            updateCracks();
        }
        
        // ============================
        // ОБНОВЛЕНИЕ ИНТЕРФЕЙСА
        // ============================
        
        function updateUI() {
            coinsCounter.textContent = formatNumber(gameState.coins);
            stageCounter.textContent = `Стадия ${currentStage}`;
            healthDisplay.textContent = `${Math.floor(gameState.currentHealth)}/${gameState.maxHealth}`;
            
            const healthPercent = (gameState.currentHealth / gameState.maxHealth) * 100;
            progressBar.style.width = `${healthPercent}%`;
            
            if (healthPercent > 70) {
                progressBar.style.background = "linear-gradient(to right, #4CAF50, #8BC34A)";
            } else if (healthPercent > 30) {
                progressBar.style.background = "linear-gradient(to right, #FF9800, #FFC107)";
            } else {
                progressBar.style.background = "linear-gradient(to right, #F44336, #FF5722)";
            }
            
            updateStatsDisplay();
            updateCracks();
            
            checkActiveBoosts();
        }
        
        function checkActiveBoosts() {
            const now = Date.now();
            
            if (gameState.doubleCoinsActive && now > gameState.doubleCoinsEnd) {
                gameState.doubleCoinsActive = false;
                if (gameState.notificationsEnabled) {
                    showBoostNotification('Удвоение монет закончилось');
                }
            }
            
            if (gameState.damageBoostActive && now > gameState.damageBoostEnd) {
                gameState.damageBoostActive = false;
                if (gameState.notificationsEnabled) {
                    showBoostNotification('Буст урона закончился');
                }
            }
            
            if (gameState.luckBoostActive && now > gameState.luckBoostEnd) {
                gameState.luckBoostActive = false;
                if (gameState.notificationsEnabled) {
                    showBoostNotification('Буст удачи закончился');
                }
            }
        }
        
        function showBoostNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(45deg, #FF9800, #FF5722);
                color: white;
                padding: 10px 20px;
                border-radius: 10px;
                font-size: 1rem;
                font-weight: bold;
                z-index: 1000;
                text-align: center;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                animation: fadeIn 0.5s, fadeOut 0.5s 2.5s forwards;
            `;
            
            notification.innerHTML = `
                <div style="font-size: 1.2rem; margin-bottom: 5px;">
                    <i class="fas fa-hourglass-end"></i>
                </div>
                <div>${message}</div>
            `;
            
            document.getElementById('game-container').appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        function updateCracks() {
            const healthPercent = gameState.currentHealth / gameState.maxHealth;
            let crackLevel = 0;
            
            if (healthPercent < 0.33) {
                crackLevel = 2;
            } else if (healthPercent < 0.66) {
                crackLevel = 1;
            }
            
            const opacity = 1 - healthPercent;
            cracksOverlay.style.opacity = opacity * 0.9;
            
            const crackSVG = createCrackSVG(crackLevel);
            cracksOverlay.style.backgroundImage = `url('${crackSVG}')`;
        }
        
        function createCrackSVG(level) {
            const strokeWidth = 3 + level;
            const opacity = 0.3 + (level * 0.2);
            
            const svgCode = `
                <svg width="240" height="240" viewBox="0 0 240 240" xmlns="http://www.w3.org/2000/svg">
                    <path d="M${40 + level * 10},${40 + level * 5} L${60 + level * 10},${70 + level * 5} M${80 + level * 5},${30 + level * 5} L${100 + level * 5},${60 + level * 5} M${120 + level * 10},${70 + level * 5} L${100 + level * 10},${100 + level * 5} M${50 + level * 5},${100 + level * 10} L${70 + level * 5},${130 + level * 10} M${90 + level * 10},${140 + level * 5} L${110 + level * 10},${170 + level * 5} M${130 + level * 5},${160 + level * 10} L${110 + level * 5},${190 + level * 10} M${160 + level * 10},${50 + level * 5} L${180 + level * 10},${80 + level * 5} M${180 + level * 5},${110 + level * 10} L${160 + level * 5},${140 + level * 10} M${190 + level * 10},${80 + level * 5} L${170 + level * 10},${110 + level * 5}" 
                    stroke="#000" stroke-width="${strokeWidth}" stroke-opacity="${opacity}" fill="none"/>
                </svg>
            `;
            
            const svgBlob = new Blob([svgCode], {type: 'image/svg+xml'});
            return URL.createObjectURL(svgBlob);
        }
        
        function updateStatsDisplay() {
            const dps = calculateDPS();
            document.getElementById('dps-counter').textContent = dps.toFixed(1);
            document.getElementById('total-clicks').textContent = formatNumber(gameState.totalClicks);
            document.getElementById('blocks-broken').textContent = formatNumber(gameState.blocksBroken);
            
            const totalSeconds = gameState.playTimeSeconds + Math.floor((Date.now() - gameState.startTime) / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            if (hours > 0) {
                document.getElementById('play-time').textContent = `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            } else {
                document.getElementById('play-time').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
        }
        
        function calculateDPS() {
            let baseDamage = 0.95 * gameState.damageMultiplier;
            
            if (gameState.damageBoostActive) {
                baseDamage *= 3;
            }
            
            if (gameState.purchasedItems['unbreakable_pickaxe']) {
                baseDamage *= 2;
            }
            
            let autoClickerDamage = 0;
            gameState.autoClickers.forEach(clicker => {
                const item = shopItems.find(i => i.id === clicker.id);
                if (item && gameState.purchasedItems[clicker.id]) {
                    const level = gameState.purchasedItems[clicker.id].level || 1;
                    const stats = item.getStats ? item.getStats(level) : { damage: item.effect.baseDamage, interval: item.effect.baseInterval };
                    
                    let damage = stats.damage + gameState.autoClickerDamage;
                    if (gameState.purchasedItems['auto_clicker_master']) {
                        damage *= 1.5;
                    }
                    
                    autoClickerDamage += damage / (stats.interval / 1000);
                }
            });
            
            const critDamage = baseDamage * gameState.criticalMultiplier;
            const averageDamage = baseDamage * (1 - gameState.criticalChance / 100) + critDamage * (gameState.criticalChance / 100);
            
            return averageDamage + autoClickerDamage;
        }
        
        // ============================
        // ИГРОВОЙ ПРОЦЕСС
        // ============================
        
        function handleBlockClick(event) {
            if (gameState.isBreaking) return;
            
            const now = Date.now();
            const blockStartTime = gameState.lastHitTime;
            gameState.lastHitTime = now;
            gameState.totalClicks++;
            
            // Обработка комбо
            if (gameState.lastClickTime > 0 && now - gameState.lastClickTime < 2000) {
                gameState.currentCombo++;
                if (gameState.currentCombo > gameState.maxCombo) {
                    gameState.maxCombo = gameState.currentCombo;
                }
            } else {
                gameState.currentCombo = 1;
            }
            gameState.lastClickTime = now;
            
            // Сброс таймера регенерации
            if (gameState.regenerationTimer) {
                clearTimeout(gameState.regenerationTimer);
                gameState.regenerationTimer = null;
            }
            
            if (regenerationIndicator.style.display === 'block') {
                regenerationIndicator.style.display = 'none';
                block.classList.remove('regenerating');
            }
            
            // Расчет урона
            let damage = 0.95 * gameState.damageMultiplier;
            let isCritical = false;
            
            // Умножение урона от бустов
            if (gameState.damageBoostActive) {
                damage *= 3;
            }
            
            if (gameState.purchasedItems['unbreakable_pickaxe']) {
                damage *= 2;
            }
            
            // Проверка критического удара
            if (Math.random() * 100 < gameState.criticalChance) {
                damage *= gameState.criticalMultiplier;
                isCritical = true;
                gameState.criticalHits++;
            }
            
            // Применение урона
            const previousHealth = gameState.currentHealth;
            gameState.currentHealth -= damage;
            gameState.totalDamage += damage;
            
            // Статистика для достижений
            if (gameState.antiRegen) {
                gameState.noRegenBlocks++;
            }
            
            if (previousHealth === gameState.maxHealth && gameState.currentHealth <= 0) {
                gameState.perfectHits++;
                gameState.oneHitBlocks++;
            }
            
            // Анимации
            if (gameState.animationsEnabled) {
                block.classList.add('hit');
                setTimeout(() => {
                    block.classList.remove('hit');
                }, 100);
                
                if (isCritical) {
                    showDamageIndicator(event, damage, true);
                } else {
                    showDamageIndicator(event, damage, false);
                }
            }
            
            // Получение монет
            const coinsEarned = getCoinsFromHit();
            if (coinsEarned > 0) {
                gameState.coins += coinsEarned;
                gameState.totalCoinsEarned += coinsEarned;
                gameState.sessionCoins += coinsEarned;
                
                if (gameState.animationsEnabled) {
                    showCoinAnimation(event, coinsEarned);
                }
            }
            
            // Проверка разрушения блока
            if (gameState.currentHealth <= 0) {
                destroyBlock(blockStartTime);
            } else {
                updateUI();
                
                // Запуск регенерации
                if (gameState.regenerationEnabled && !gameState.antiRegen) {
                    startRegenerationTimer();
                }
            }
            
            // Проверка достижений
            checkAchievements();
            saveGame();
        }
        
        function getCoinsFromHit() {
            let blockData;
            
            if (isLuckyBlockActive) {
                blockData = luckyBlockData;
            } else {
                blockData = blocks[gameState.currentBlock];
                if (!blockData) return 0;
            }
            
            const minCoins = blockData.baseCoins.min;
            const maxCoins = blockData.baseCoins.max;
            let coins = Math.floor(Math.random() * (maxCoins - minCoins + 1)) + minCoins;
            
            // Применение множителей
            coins *= gameState.coinMultiplier;
            coins *= gameState.luckMultiplier;
            coins *= (1 + ((currentStage - 1) * 0.1));
            
            // Временные бусты
            if (gameState.doubleCoinsActive) {
                coins *= 2;
            }
            
            if (gameState.luckBoostActive) {
                coins *= 2;
            }
            
            // Случайный бонус
            if (Math.random() * 100 < gameState.criticalChance / 2) {
                coins *= 2;
            }
            
            return Math.round(coins);
        }
        
        function showDamageIndicator(event, damage, isCritical) {
            const rect = block.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            const damageElement = document.createElement('div');
            damageElement.className = 'damage-indicator';
            damageElement.textContent = `-${Math.round(damage)}`;
            damageElement.style.left = `${x}px`;
            damageElement.style.top = `${y}px`;
            
            if (isCritical) {
                damageElement.style.color = '#FFD700';
                damageElement.style.fontSize = '1.5rem';
                damageElement.style.textShadow = '0 0 10px #FFD700';
            }
            
            block.appendChild(damageElement);
            
            setTimeout(() => {
                damageElement.remove();
            }, 1000);
        }
        
        function showCoinAnimation(event, amount) {
            const rect = block.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            const coinElement = document.createElement('div');
            coinElement.className = 'coin-hit-animation';
            coinElement.textContent = `+${amount}`;
            coinElement.style.left = `${x}px`;
            coinElement.style.top = `${y}px`;
            
            block.appendChild(coinElement);
            
            setTimeout(() => {
                coinElement.remove();
            }, 1000);
        }
        
        function destroyBlock(blockStartTime) {
            gameState.isBreaking = true;
            gameState.blocksBroken++;
            
            let blockData;
            let bonusCoins;
            
            if (isLuckyBlockActive) {
                blockData = luckyBlockData;
                gameState.luckyBlocksFound++;
                bonusCoins = 5000;
                isLuckyBlockActive = false;
                
                // Обработка последовательных Lucky Blocks
                if (lastBlockWasLucky) {
                    gameState.consecutiveLuckyBlocks++;
                    if (gameState.consecutiveLuckyBlocks > gameState.maxConsecutiveLucky) {
                        gameState.maxConsecutiveLucky = gameState.consecutiveLuckyBlocks;
                    }
                } else {
                    gameState.consecutiveLuckyBlocks = 1;
                }
                lastBlockWasLucky = true;
            } else {
                blockData = blocks[gameState.currentBlock];
                bonusCoins = Math.floor(blockData.baseCoins.max * 3 * gameState.coinMultiplier * (1 + ((currentStage - 1) * 0.1)));
                
                // Запись статистики по типам блоков
                if (gameState.currentBlock < gameState.blocksDestroyed.length) {
                    gameState.blocksDestroyed[gameState.currentBlock] = (gameState.blocksDestroyed[gameState.currentBlock] || 0) + 1;
                }
                
                // Проверка быстрого разрушения
                const breakTime = (Date.now() - blockStartTime) / 1000;
                if (breakTime < 3) {
                    gameState.fastBlockBreaks++;
                }
                
                lastBlockWasLucky = false;
                gameState.consecutiveLuckyBlocks = 0;
            }
            
            // Применение бустов к бонусным монетам
            let finalCoins = bonusCoins;
            if (gameState.doubleCoinsActive) {
                finalCoins *= 2;
            }
            if (gameState.luckBoostActive) {
                finalCoins *= 2;
            }
            
            gameState.coins += finalCoins;
            gameState.totalCoinsEarned += finalCoins;
            gameState.sessionCoins += finalCoins;
            
            // Анимация разрушения
            if (gameState.animationsEnabled) {
                block.style.animation = 'breakBlock 0.5s forwards';
            }
            
            setTimeout(() => {
                if (!isLuckyBlockActive) {
                    gameState.currentBlock++;
                    
                    if (gameState.currentBlock >= blocks.length) {
                        startNewStage();
                    }
                }
                
                block.style.animation = '';
                gameState.isBreaking = false;
                
                initCurrentBlock();
                updateUI();
                
                checkAchievements();
                saveGame();
            }, 500);
        }
        
        function startNewStage() {
            currentStage++;
            
            if (currentStage > gameState.highestStage) {
                gameState.highestStage = currentStage;
            }
            
            initializeBlocks(currentStage);
            gameState.currentBlock = 0;
            
            if (gameState.notificationsEnabled) {
                showNewStageNotification();
            }
            
            initCurrentBlock();
            updateUI();
            saveGame();
        }
        
        function showNewStageNotification() {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(45deg, #9C27B0, #7B1FA2);
                color: white;
                padding: 20px 30px;
                border-radius: 15px;
                font-size: 1.5rem;
                font-weight: bold;
                z-index: 1000;
                text-align: center;
                box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                animation: fadeIn 0.5s, fadeOut 0.5s 3s forwards;
            `;
            
            notification.innerHTML = `
                <div style="font-size: 2rem; margin-bottom: 10px;">
                    <i class="fas fa-arrow-up"></i>
                </div>
                <div>Стадия ${currentStage}!</div>
                <div style="font-size: 1rem; margin-top: 10px; opacity: 0.8;">
                    Здоровье блоков увеличено на 25%
                </div>
            `;
            
            document.getElementById('game-container').appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3500);
        }
        
        // ============================
        // РЕГЕНЕРАЦИЯ (ИСПРАВЛЕННОЕ ВРЕМЯ)
        // ============================
        
        function startRegenerationTimer() {
            if (gameState.antiRegen || !gameState.regenerationEnabled) return;
            
            gameState.regenerationTimer = setTimeout(() => {
                startRegeneration();
            }, gameState.regenerationDelay); // 30 секунд
        }
        
        function startRegeneration() {
            if (gameState.isBreaking || gameState.antiRegen || !gameState.regenerationEnabled) return;
            
            regenerationIndicator.style.display = 'block';
            block.classList.add('regenerating');
            
            gameState.regenerationInterval = setInterval(() => {
                if (gameState.isBreaking || gameState.antiRegen || gameState.currentHealth >= gameState.maxHealth) {
                    stopRegeneration();
                    return;
                }
                
                gameState.currentHealth = Math.min(gameState.currentHealth + gameState.regenerationRate, gameState.maxHealth);
                updateUI();
                
                regenerationIndicator.textContent = `+${gameState.regenerationRate} HP`;
                
                if (gameState.currentHealth >= gameState.maxHealth) {
                    stopRegeneration();
                }
            }, 1000); // Каждую секунду
        }
        
        function stopRegeneration() {
            if (gameState.regenerationInterval) {
                clearInterval(gameState.regenerationInterval);
                gameState.regenerationInterval = null;
            }
            
            regenerationIndicator.style.display = 'none';
            block.classList.remove('regenerating');
            
            if (gameState.regenerationEnabled && !gameState.antiRegen) {
                startRegenerationTimer();
            }
        }
        
        // ============================
        // АВТОКЛИКЕРЫ (7 УРОВНЕЙ)
        // ============================
        
        function addAutoClicker(clickerData, level = 1) {
            const existingClicker = gameState.autoClickers.find(c => c.id === clickerData.id);
            
            if (existingClicker) {
                existingClicker.level = level;
                restartAutoClickers();
            } else {
                gameState.autoClickers.push({
                    id: clickerData.id,
                    name: clickerData.name,
                    level: level
                });
                restartAutoClickers();
            }
        }
        
        function restartAutoClickers() {
            // Останавливаем все текущие автокликеры
            gameState.autoClickerIntervals.forEach(intervalId => clearInterval(intervalId));
            gameState.autoClickerIntervals = [];
            
            // Запускаем все автокликеры заново
            gameState.autoClickers.forEach(clicker => {
                const item = shopItems.find(i => i.id === clicker.id);
                if (item) {
                    startAutoClicker(item, clicker.level || 1);
                }
            });
        }
        
        function startAutoClicker(clickerData, level = 1) {
            const stats = clickerData.getStats ? clickerData.getStats(level) : { 
                damage: clickerData.effect.baseDamage, 
                interval: clickerData.effect.baseInterval 
            };
            
            let damage = stats.damage + gameState.autoClickerDamage;
            let interval = stats.interval;
            
            // Бонус от улучшения "Мастер автокликеров"
            if (gameState.purchasedItems['auto_clicker_master']) {
                damage *= 1.5;
            }
            
            const intervalId = setInterval(() => {
                if (!gameState.isBreaking) {
                    const rect = block.getBoundingClientRect();
                    const event = {
                        clientX: rect.left + rect.width / 2,
                        clientY: rect.top + rect.height / 2
                    };
                    
                    gameState.currentHealth -= damage;
                    gameState.totalDamage += damage;
                    gameState.autoDamage += damage;
                    
                    if (gameState.notificationsEnabled && gameState.autoClickers.length <= 3) {
                        autoClickerInfo.textContent = `${clickerData.name} Lv.${level}: -${damage} HP`;
                        autoClickerInfo.style.display = 'block';
                        
                        setTimeout(() => {
                            autoClickerInfo.style.display = 'none';
                        }, 1000);
                    }
                    
                    if (gameState.currentHealth <= 0) {
                        destroyBlock(Date.now());
                    } else {
                        updateUI();
                    }
                }
            }, interval);
            
            gameState.autoClickerIntervals.push(intervalId);
        }
        
        // ============================
        // МАГАЗИН (УЛУЧШЕННЫЙ)
        // ============================
        
        function loadShopItems() {
            const shopItemsContainer = document.getElementById('shop-items-container');
            shopItemsContainer.innerHTML = '';
            
            shopItems.forEach((item, index) => {
                const isPurchased = gameState.purchasedItems[item.id];
                const level = isPurchased ? (isPurchased.level || 1) : 0;
                const canLevelUp = item.consumable ? true : (level < (item.maxLevel || 1));
                const price = item.basePrice ? Math.floor(item.basePrice * Math.pow(item.priceMultiplier || 1, level)) : item.price;
                const canPurchase = gameState.coins >= price && canLevelUp && (!item.requires || gameState.purchasedItems[item.requires]);
                
                const shopItem = document.createElement('div');
                shopItem.className = 'shop-item';
                shopItem.dataset.category = item.category;
                shopItem.style.animationDelay = `${index * 0.1}s`;
                
                let levelInfo = '';
                if (item.maxLevel > 1 && !item.consumable) {
                    levelInfo = `
                        <div class="shop-item-level">
                            <span class="item-level">Уровень: ${level}/${item.maxLevel}</span>
                            <div class="level-progress">
                                <div class="level-progress-fill" style="width: ${(level / item.maxLevel) * 100}%"></div>
                            </div>
                        </div>
                    `;
                }
                
                let description = item.description;
                if (item.getDescription && level > 0 && !item.consumable) {
                    description = item.getDescription(level + 1);
                }
                
                let countInfo = '';
                if (item.consumable && isPurchased) {
                    countInfo = `<div style="color: #4CAF50; font-weight: bold;">Куплено: ${isPurchased.count || 1}</div>`;
                }
                
                let statsInfo = '';
                if (item.getStats && !item.consumable) {
                    const currentStats = item.getStats(level);
                    const nextStats = item.getStats(level + 1);
                    
                    if (currentStats && nextStats) {
                        if (item.category === 'clickers') {
                            statsInfo = `
                                <div class="item-stats">
                                    <div>Сейчас: ${currentStats.damage} урон / ${currentStats.interval/1000}сек</div>
                                    ${level < item.maxLevel ? `<div>Следующий: ${nextStats.damage} урон / ${nextStats.interval/1000}сек</div>` : ''}
                                </div>
                            `;
                        } else if (item.category === 'boosters') {
                            const currentBonus = Math.round((currentStats.multiplier - 1) * 100);
                            const nextBonus = Math.round((nextStats.multiplier - 1) * 100);
                            statsInfo = `
                                <div class="item-stats">
                                    <div>Сейчас: +${currentBonus}%</div>
                                    ${level < item.maxLevel ? `<div>Следующий: +${nextBonus}%</div>` : ''}
                                </div>
                            `;
                        }
                    }
                }
                
                shopItem.innerHTML = `
                    <div class="item-header">
                        <div class="item-title">
                            <div class="item-icon" style="background-color: ${item.iconColor};">
                                <i class="${item.icon}"></i>
                            </div>
                            ${item.name} ${item.maxLevel > 1 && !item.consumable ? `<span style="color: var(--accent-color); font-size: 0.9rem;">Lv.${level}</span>` : ''}
                        </div>
                        <div class="item-price">${formatNumber(price)}</div>
                    </div>
                    ${levelInfo}
                    <div class="item-description">${description}</div>
                    ${statsInfo}
                    ${countInfo}
                    <button class="buy-btn" data-id="${item.id}" ${!canPurchase ? 'disabled' : ''}>
                        ${level === 0 ? '<i class="fas fa-shopping-cart"></i> Купить' : 
                          item.consumable ? `<i class="fas fa-plus"></i> Купить еще (${formatNumber(price)})` :
                          level < item.maxLevel ? `<i class="fas fa-arrow-up"></i> Улучшить до Lv.${level + 1} (${formatNumber(price)})` : 
                          '<i class="fas fa-check"></i> Макс. уровень'}
                    </button>
                `;
                
                shopItemsContainer.appendChild(shopItem);
            });
            
            // Обработка категорий
            document.querySelectorAll('.shop-categories .category-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const category = this.dataset.category;
                    
                    document.querySelectorAll('.shop-categories .category-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.querySelectorAll('.shop-item').forEach(item => {
                        if (category === 'all' || item.dataset.category === category) {
                            item.style.display = 'block';
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            });
        }
        
        function loadStats() {
            const statsContainer = document.getElementById('stats-container');
            statsContainer.innerHTML = '';
            
            const totalPlayTime = gameState.playTimeSeconds + Math.floor((Date.now() - gameState.startTime) / 1000);
            const hours = Math.floor(totalPlayTime / 3600);
            const minutes = Math.floor((totalPlayTime % 3600) / 60);
            
            const stats = [
                { label: 'Всего кликов', value: gameState.totalClicks, icon: 'fas fa-mouse-pointer' },
                { label: 'Разрушено блоков', value: gameState.blocksBroken, icon: 'fas fa-gem' },
                { label: 'Заработано монет', value: gameState.totalCoinsEarned, icon: 'fas fa-coins' },
                { label: 'Нанесено урона', value: Math.floor(gameState.totalDamage), icon: 'fas fa-fist-raised' },
                { label: 'Найдено Lucky Blocks', value: gameState.luckyBlocksFound, icon: 'fas fa-star' },
                { label: 'УВС (урон/сек)', value: calculateDPS().toFixed(1), icon: 'fas fa-tachometer-alt' },
                { label: 'Время игры', value: hours > 0 ? `${hours}ч ${minutes}м` : `${minutes}м`, icon: 'fas fa-clock' },
                { label: 'Автокликеров', value: gameState.autoClickers.length, icon: 'fas fa-robot' },
                { label: 'Куплено предметов', value: gameState.totalItemsPurchased, icon: 'fas fa-shopping-bag' },
                { label: 'Текущая стадия', value: currentStage, icon: 'fas fa-layer-group' },
                { label: 'Макс. стадия', value: gameState.highestStage, icon: 'fas fa-trophy' },
                { label: 'Текущие монеты', value: gameState.coins, icon: 'fas fa-coins' },
                { label: 'Достижения', value: `${gameState.achievementsUnlocked}/81`, icon: 'fas fa-trophy' },
                { label: 'Макс. комбо', value: gameState.maxCombo, icon: 'fas fa-fire' },
                { label: 'Критических ударов', value: gameState.criticalHits, icon: 'fas fa-bolt' },
                { label: 'Идеальных ударов', value: gameState.perfectHits, icon: 'fas fa-star' },
                { label: 'Быстрых разрушений', value: gameState.fastBlockBreaks, icon: 'fas fa-running' },
                { label: 'Макс. УВС', value: gameState.maxDPS.toFixed(1), icon: 'fas fa-chart-line' },
                { label: 'Урон от автокликеров', value: Math.floor(gameState.autoDamage), icon: 'fas fa-cogs' },
                { label: 'Потрачено монет', value: gameState.totalCoinsSpent, icon: 'fas fa-money-bill-wave' }
            ];
            
            stats.forEach((stat, index) => {
                const statCard = document.createElement('div');
                statCard.className = 'stat-card';
                statCard.style.animationDelay = `${index * 0.1}s`;
                
                statCard.innerHTML = `
                    <div style="font-size: 1.5rem; color: #4CAF50; margin-bottom: 5px;">
                        <i class="${stat.icon}"></i>
                    </div>
                    <div class="stat-card-value">${typeof stat.value === 'number' ? formatNumber(stat.value) : stat.value}</div>
                    <div class="stat-card-label">${stat.label}</div>
                `;
                
                statsContainer.appendChild(statCard);
            });
        }
        
        function purchaseItem(itemId) {
            const item = shopItems.find(i => i.id === itemId);
            if (!item) return false;
            
            const isPurchased = gameState.purchasedItems[itemId];
            const level = isPurchased ? (isPurchased.level || 1) : 0;
            
            if (!item.consumable && level >= (item.maxLevel || 1)) {
                alert('Достигнут максимальный уровень!');
                return false;
            }
            
            if (item.requires && !gameState.purchasedItems[item.requires]) {
                alert(`Сначала нужно купить: ${shopItems.find(i => i.id === item.requires).name}`);
                return false;
            }
            
            const price = item.basePrice ? Math.floor(item.basePrice * Math.pow(item.priceMultiplier || 1, level)) : item.price;
            
            if (gameState.coins < price) {
                alert('Недостаточно монет!');
                return false;
            }
            
            gameState.coins -= price;
            gameState.totalCoinsSpent += price;
            gameState.totalItemsPurchased++;
            
            if (item.category === 'clickers') {
                gameState.autoClickersPurchased++;
            }
            
            applyItemEffect(item, level + 1);
            
            if (item.consumable) {
                if (!isPurchased) {
                    gameState.purchasedItems[itemId] = { count: 1 };
                } else {
                    gameState.purchasedItems[itemId].count = (gameState.purchasedItems[itemId].count || 1) + 1;
                }
            } else {
                if (item.maxLevel > 1) {
                    const newLevel = level + 1;
                    gameState.purchasedItems[itemId] = { level: newLevel };
                    
                    if (newLevel === item.maxLevel) {
                        gameState.maxUpgrades++;
                    }
                    
                    if (item.category === 'clickers') {
                        addAutoClicker(item, newLevel);
                    }
                } else {
                    gameState.purchasedItems[itemId] = true;
                    
                    if (item.category === 'clickers') {
                        addAutoClicker(item, 1);
                    }
                }
            }
            
            updateUI();
            loadShopItems();
            checkAchievements();
            saveGame();
            
            return true;
        }
        
        function applyItemEffect(item, level) {
            switch (item.effect.type) {
                case 'autoClicker':
                    // Обрабатывается в addAutoClicker
                    break;
                    
                case 'damageMultiplier':
                    gameState.damageMultiplier = item.effect.values[level - 1] || item.effect.values[0];
                    break;
                    
                case 'coinMultiplier':
                    gameState.coinMultiplier = item.effect.values[level - 1] || item.effect.values[0];
                    break;
                    
                case 'luckMultiplier':
                    gameState.luckMultiplier = item.effect.values[level - 1] || item.effect.values[0];
                    break;
                    
                case 'critical':
                    if (item.getStats) {
                        const stats = item.getStats(level);
                        gameState.criticalChance += stats.chance || 0;
                        gameState.criticalMultiplier = stats.multiplier || 2;
                    } else {
                        gameState.criticalChance += item.effect.baseChance || 0;
                        gameState.criticalMultiplier *= item.effect.baseMultiplier || 2;
                    }
                    break;
                    
                case 'antiRegen':
                    gameState.antiRegen = true;
                    stopRegeneration();
                    break;
                    
                case 'doubleCoins':
                    gameState.doubleCoinsActive = true;
                    gameState.doubleCoinsEnd = Date.now() + item.effect.duration;
                    showBoostNotification('Удвоение монет активировано на 60 секунд!');
                    break;
                    
                case 'damageBoost':
                    gameState.damageBoostActive = true;
                    gameState.damageBoostEnd = Date.now() + item.effect.duration;
                    showBoostNotification('Буст урона x3 активирован на 60 секунд!');
                    break;
                    
                case 'luckBoost':
                    gameState.luckBoostActive = true;
                    gameState.luckBoostEnd = Date.now() + item.effect.duration;
                    showBoostNotification('Буст удачи x2 активирован на 60 секунд!');
                    break;
                    
                case 'autoClickerMaster':
                    gameState.autoClickerDamageBonus = 0.5; // 50% бонус
                    restartAutoClickers();
                    break;
                    
                case 'luckyCharm':
                    gameState.luckyBlockChance *= 2;
                    break;
                    
                case 'unbreakablePickaxe':
                    // Эффект применяется при расчете урона
                    break;
            }
        }
        
        // ============================
        // УТИЛИТЫ И ФОРМАТИРОВАНИЕ
        // ============================
        
        function formatNumber(num) {
            if (num >= 1000000000) {
                return (num / 1000000000).toFixed(2) + 'B';
            } else if (num >= 1000000) {
                return (num / 1000000).toFixed(2) + 'M';
            } else if (num >= 10000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
        }
        
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            if (hours > 0) {
                return `${hours}ч ${minutes}м`;
            } else if (minutes > 0) {
                return `${minutes}м ${secs}с`;
            } else {
                return `${secs}с`;
            }
        }
        
        // ============================
        // УПРАВЛЕНИЕ И НАСТРОЙКИ
        // ============================
        
        function setupControls() {
            continueBtn.addEventListener('click', () => {
                menuScreen.style.display = 'none';
                gameScreen.style.display = 'flex';
                initCurrentBlock();
                updateUI();
            });
            
            newGameBtn.addEventListener('click', () => {
                document.getElementById('new-game-modal').style.display = 'flex';
            });
            
            document.getElementById('confirm-new-game-btn').addEventListener('click', () => {
                // Создаем новое состояние игры
                gameState = {
                    coins: 0,
                    currentBlock: 0,
                    currentHealth: 0,
                    maxHealth: 0,
                    currentStage: 1,
                    maxHealthMultiplier: 1.0,
                    highestStage: 1,
                    
                    totalClicks: 0,
                    blocksBroken: 0,
                    totalCoinsEarned: 0,
                    totalDamage: 0,
                    playTimeSeconds: 0,
                    startTime: Date.now(),
                    lastSaveTime: Date.now(),
                    
                    achievements: {},
                    achievementsUnlocked: 0,
                    
                    luckyBlocksFound: 0,
                    sessionCoins: 0,
                    sessionStartTime: Date.now(),
                    specificBlocksBroken: {},
                    totalItemsPurchased: 0,
                    totalCoinsSpent: 0,
                    criticalHits: 0,
                    maxCombo: 0,
                    currentCombo: 0,
                    lastClickTime: 0,
                    fastBlockBreaks: 0,
                    autoClickersPurchased: 0,
                    maxUpgrades: 0,
                    blocksDestroyed: Array(35).fill(0),
                    perfectHits: 0,
                    autoDamage: 0,
                    noRegenBlocks: 0,
                    oneHitBlocks: 0,
                    maxDPS: 0,
                    consecutiveLuckyBlocks: 0,
                    maxConsecutiveLucky: 0,
                    
                    damageMultiplier: 1,
                    coinMultiplier: 1,
                    luckMultiplier: 1,
                    criticalChance: 5,
                    criticalMultiplier: 2,
                    autoClickerDamageBonus: 0,
                    luckyBlockChance: 0.002,
                    
                    autoClickers: [],
                    autoClickerDamage: 0,
                    
                    regenerationEnabled: true,
                    regenerationRate: 10,
                    regenerationDelay: 30000,
                    antiRegen: false,
                    
                    doubleCoinsActive: false,
                    doubleCoinsEnd: 0,
                    damageBoostActive: false,
                    damageBoostEnd: 0,
                    luckBoostActive: false,
                    luckBoostEnd: 0,
                    
                    soundEnabled: gameState.soundEnabled,
                    notificationsEnabled: gameState.notificationsEnabled,
                    autosaveEnabled: gameState.autosaveEnabled,
                    animationsEnabled: gameState.animationsEnabled,
                    
                    purchasedItems: {},
                    
                    isBreaking: false,
                    isTouching: false,
                    lastHitTime: Date.now(),
                    regenerationTimer: null,
                    regenerationInterval: null,
                    autoClickerIntervals: [],
                    playTimer: null,
                    saveInterval: null,
                    
                    creditsShown: false
                };
                
                currentStage = 1;
                healthMultiplier = 1.0;
                
                document.getElementById('new-game-modal').style.display = 'none';
                clearSave();
                menuScreen.style.display = 'none';
                gameScreen.style.display = 'flex';
                initializeBlocks(1);
                initCurrentBlock();
                updateUI();
                loadAchievements();
            });
            
            document.getElementById('cancel-new-game-btn').addEventListener('click', () => {
                document.getElementById('new-game-modal').style.display = 'none';
            });
            
            statsMenuBtn.addEventListener('click', () => {
                menuScreen.style.display = 'none';
                statsScreen.style.display = 'flex';
                loadStats();
            });
            
            shopMenuBtn.addEventListener('click', () => {
                menuScreen.style.display = 'none';
                shopScreen.style.display = 'flex';
                loadShopItems();
            });
            
            achievementsMenuBtn.addEventListener('click', () => {
                menuScreen.style.display = 'none';
                achievementsScreen.style.display = 'flex';
                loadAchievements();
            });
            
            gameShopBtn.addEventListener('click', () => {
                gameScreen.style.display = 'none';
                shopScreen.style.display = 'flex';
                loadShopItems();
            });
            
            gameStatsBtn.addEventListener('click', () => {
                gameScreen.style.display = 'none';
                statsScreen.style.display = 'flex';
                loadStats();
            });
            
            gameMenuBtn.addEventListener('click', () => {
                gameScreen.style.display = 'none';
                menuScreen.style.display = 'flex';
                saveGame();
            });
            
            document.getElementById('shop-back-btn').addEventListener('click', () => {
                shopScreen.style.display = 'none';
                gameScreen.style.display = 'flex';
            });
            
            document.getElementById('stats-back-btn').addEventListener('click', () => {
                statsScreen.style.display = 'none';
                gameScreen.style.display = 'flex';
            });
            
            document.getElementById('achievements-back-btn').addEventListener('click', () => {
                achievementsScreen.style.display = 'none';
                gameScreen.style.display = 'flex';
            });
            
            document.getElementById('settings-back-btn').addEventListener('click', () => {
                settingsScreen.style.display = 'none';
                gameScreen.style.display = 'flex';
            });
            
            creditsBackBtn.addEventListener('click', () => {
                creditsScreen.style.display = 'none';
                menuScreen.style.display = 'flex';
                const creditsContent = document.getElementById('credits-content');
                creditsContent.style.animation = '';
            });
            
            privacyBtn.addEventListener('click', () => {
                document.getElementById('privacy-modal').style.display = 'flex';
            });
            
            document.getElementById('close-modal-btn').addEventListener('click', () => {
                document.getElementById('privacy-modal').style.display = 'none';
            });
            
            // Настройки
            document.getElementById('sound-toggle').checked = gameState.soundEnabled;
            document.getElementById('notifications-toggle').checked = gameState.notificationsEnabled;
            document.getElementById('autosave-toggle').checked = gameState.autosaveEnabled;
            document.getElementById('animations-toggle').checked = gameState.animationsEnabled;
            
            document.getElementById('sound-toggle').addEventListener('change', () => {
                gameState.soundEnabled = document.getElementById('sound-toggle').checked;
                saveGame();
            });
            
            document.getElementById('notifications-toggle').addEventListener('change', () => {
                gameState.notificationsEnabled = document.getElementById('notifications-toggle').checked;
                saveGame();
            });
            
            document.getElementById('autosave-toggle').addEventListener('change', () => {
                gameState.autosaveEnabled = document.getElementById('autosave-toggle').checked;
                saveGame();
            });
            
            document.getElementById('animations-toggle').addEventListener('change', () => {
                gameState.animationsEnabled = document.getElementById('animations-toggle').checked;
                saveGame();
            });
            
            document.getElementById('clear-data-btn').addEventListener('click', () => {
                document.getElementById('clear-data-modal').style.display = 'flex';
            });
            
            document.getElementById('confirm-clear-data-btn').addEventListener('click', () => {
                clearSave();
                document.getElementById('clear-data-modal').style.display = 'none';
                alert('Все данные игры удалены!');
                location.reload();
            });
            
            document.getElementById('cancel-clear-data-btn').addEventListener('click', () => {
                document.getElementById('clear-data-modal').style.display = 'none';
            });
            
            document.getElementById('about-btn').addEventListener('click', () => {
                document.getElementById('about-modal').style.display = 'flex';
            });
            
            document.getElementById('close-about-modal-btn').addEventListener('click', () => {
                document.getElementById('about-modal').style.display = 'none';
            });
            
            window.addEventListener('click', (event) => {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                }
            });
            
            // Управление блоком
            block.addEventListener('mousedown', (event) => {
                if (!gameState.isTouching) {
                    gameState.isTouching = true;
                    handleBlockClick(event);
                }
            });
            
            block.addEventListener('mouseup', () => {
                gameState.isTouching = false;
            });
            
            block.addEventListener('mouseleave', () => {
                gameState.isTouching = false;
            });
            
            block.addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (!gameState.isTouching) {
                    gameState.isTouching = true;
                    const touch = e.touches[0];
                    const event = {
                        clientX: touch.clientX,
                        clientY: touch.clientY
                    };
                    handleBlockClick(event);
                }
            });
            
            block.addEventListener('touchend', (e) => {
                e.preventDefault();
                gameState.isTouching = false;
            });
            
            block.addEventListener('touchcancel', () => {
                gameState.isTouching = false;
            });
            
            // Покупка предметов
            document.getElementById('shop-items-container').addEventListener('click', (e) => {
                const buyBtn = e.target.closest('.buy-btn');
                if (buyBtn && !buyBtn.disabled) {
                    const itemId = buyBtn.dataset.id;
                    const success = purchaseItem(itemId);
                    
                    if (success) {
                        // Покупка успешна
                    }
                }
            });
            
            // Категории достижений
            document.querySelectorAll('.achievement-categories .category-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const category = this.dataset.category;
                    
                    document.querySelectorAll('.achievement-categories .category-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    loadAchievements();
                });
            });
            
            block.addEventListener('contextmenu', (e) => e.preventDefault());
        }
        
        // ============================
        // ТАЙМЕРЫ
        // ============================
        
        function startTimers() {
            // Таймер игрового времени
            gameState.playTimer = setInterval(() => {
                gameState.playTimeSeconds++;
                updateStatsDisplay();
                checkActiveBoosts();
                
                // Проверка достижений каждые 5 секунд
                if (gameState.playTimeSeconds % 5 === 0) {
                    checkAchievements();
                }
            }, 1000);
            
            // Автосохранение
            gameState.saveInterval = setInterval(() => {
                saveGame();
            }, 30000);
            
            // Запуск автокликеров
            gameState.autoClickers.forEach(clicker => {
                const item = shopItems.find(i => i.id === clicker.id);
                if (item) {
                    startAutoClicker(item, clicker.level || 1);
                }
            });
            
            // Запуск таймера регенерации
            if (gameState.regenerationEnabled && !gameState.antiRegen) {
                startRegenerationTimer();
            }
        }
        
        // ============================
        // ЗАПУСК ИГРЫ
        // ============================
        
        window.addEventListener('DOMContentLoaded', initGame);
        
        window.addEventListener('beforeunload', () => {
            saveGame();
        });
        
        window.addEventListener('unload', () => {
            saveGame();
        });
    </script>
</body>
</html>
